{% extends 'shopkeeper/s_base.html' %}
{% block title %}Profile | MyBillingApp{% endblock %}
{% block shop_name %} {{ shop_name }} {% endblock %}
{% block content %}
<link rel="stylesheet" href="https://unpkg.com/@fortawesome/fontawesome-free/css/all.min.css">
<script src="https://unpkg.com/feather-icons"></script>

<style>
  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(30px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  @keyframes slideInLeft {
    from {
      opacity: 0;
      transform: translateX(-50px);
    }
    to {
      opacity: 1;
      transform: translateX(0);
    }
  }

  @keyframes fadeIn {
    from {
      opacity: 0;
    }
    to {
      opacity: 1;
    }
  }

  .fade-in-up {
    animation: fadeInUp 0.6s ease-out;
  }

  .slide-in-left {
    animation: slideInLeft 0.5s ease-out;
  }

  .fade-in {
    animation: fadeIn 0.4s ease-out;
  }

  .gradient-bg {
    background: linear-gradient(135deg, #ed6a3e 0%, #f97316 100%);
  }

  .document-card {
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    border: 1px solid #e2e8f0;
  }

  .document-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 20px 25px -5px rgba(237, 106, 62, 0.1), 0 10px 10px -5px rgba(237, 106, 62, 0.04);
    border-color: #ed6a3e;
  }

  .info-card {
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .info-card:hover {
    transform: translateX(5px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
  }
</style>

<div class="p-4 md:p-8 lg:-mt-8">
    <!-- Hero Section - Profile View -->
    <div class="fade-in-up bg-gray-200 rounded-3xl p-8 md:p-12 mb-8 shadow-2xl">
        <div class="flex flex-col md:flex-row items-center space-y-6 md:space-y-0 md:space-x-8">
            <!-- Profile Image -->
            <div class="relative group">
                <div class="w-32 h-32 md:w-40 md:h-40 rounded-full overflow-hidden border-4 border-white shadow-xl ring-8 ring-white/20 transform hover:scale-105 transition-all duration-300">
                    {% if shopkeeper.selfie_path %}
                    <img src="{{ url_for('static', filename=shopkeeper.selfie_path) }}" 
                         alt="Shop Logo" 
                         class="w-full h-full object-cover">
                    {% else %}
                    <div class="w-full h-full flex items-center justify-center bg-orange-200 backdrop-blur-sm">
                        <i data-feather="user" class="w-12 h-12 text-orange-600"></i>
                    </div>
                    {% endif %}
                </div>
                <div class="absolute -bottom-2 -right-2 bg-emerald-500 w-8 h-8 rounded-full border-4 border-white flex items-center justify-center shadow-md">
                    <i data-feather="check" class="w-4 h-4 text-white"></i>
                </div>
            </div>
            
            <!-- Profile Info -->
            <div class="flex-1 text-center md:text-left">
                <h1 class="text-3xl md:text-5xl font-bold mb-3 text-gray-600 tracking-tight">{{ shopkeeper.shop_name or 'Shop Name' }}</h1>
                <div class="flex items-center justify-center md:justify-start mb-4">
                    <i data-feather="briefcase" class="w-5 h-5 mr-2"></i>
                    <span class="text-xl text-gray-600">{{ shopkeeper.business_type or shopkeeper.domain or 'Business Type' }}</span>
                </div>
                
                <div class="flex flex-wrap justify-center md:justify-start gap-3 mb-6">
                    {% if shopkeeper.established_year %}
                    <div class="flex items-center bg-white/20 px-3 py-1 rounded-full text-sm">
                        <i data-feather="calendar" class="w-4 h-4 mr-2"></i>
                        Est. {{ shopkeeper.established_year }}
                    </div>
                    {% endif %}
                    
                    {% if shopkeeper.city %}
                    <div class="flex items-center bg-white/20 px-3 py-1 rounded-full text-sm">
                        <i data-feather="map-pin" class="w-4 h-4 mr-2"></i>
                        {{ shopkeeper.city }}{{ ', ' + shopkeeper.state if shopkeeper.state else '' }}
                    </div>
                    {% endif %}
                    
                    {% if shopkeeper.gst_number %}
                    <div class="flex items-center bg-white/20 px-3 py-1 rounded-full text-sm">
                        <i data-feather="award" class="w-4 h-4 mr-2"></i>
                        GST Registered
                    </div>
                    {% endif %}
                    
                    {% if shopkeeper.is_verified %}
                    <div class="flex items-center bg-emerald-500/20 px-3 py-1 rounded-full text-sm">
                        <i data-feather="shield-check" class="w-4 h-4 mr-2"></i>
                        Verified Business
                    </div>
                    {% endif %}
                </div>

                <p class="text-lg opacity-90 leading-relaxed text-gray-600 max-w-2xl">Professional business services with verified credentials and comprehensive billing solutions.</p>
            </div>
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
        <a href="{{ url_for('shopkeeper.create_bill') }}" 
           class="bg-white rounded-xl shadow-lg p-6 text-center hover:shadow-xl transform hover:-translate-y-1 transition-all duration-300 border border-gray-200">
            <div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-3">
                <i data-feather="file-plus" class="w-6 h-6 text-blue-600"></i>
            </div>
            <h3 class="font-semibold text-gray-800 mb-1">Create Bill</h3>
            <p class="text-xs text-gray-600">Generate new invoice</p>
        </a>
        
        <a href="{{ url_for('shopkeeper.sales_bills') }}" 
           class="bg-white rounded-xl shadow-lg p-6 text-center hover:shadow-xl transform hover:-translate-y-1 transition-all duration-300 border border-gray-200">
            <div class="w-12 h-12 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-3">
                <i data-feather="file-text" class="w-6 h-6 text-green-600"></i>
            </div>
            <h3 class="font-semibold text-gray-800 mb-1">View Bills</h3>
            <p class="text-xs text-gray-600">Manage invoices</p>
        </a>
        
        <a href="{{ url_for('shopkeeper.products_stock') }}" 
           class="bg-white rounded-xl shadow-lg p-6 text-center hover:shadow-xl transform hover:-translate-y-1 transition-all duration-300 border border-gray-200">
            <div class="w-12 h-12 bg-purple-100 rounded-full flex items-center justify-center mx-auto mb-3">
                <i data-feather="box" class="w-6 h-6 text-purple-600"></i>
            </div>
            <h3 class="font-semibold text-gray-800 mb-1">Products</h3>
            <p class="text-xs text-gray-600">Manage inventory</p>
        </a>
        
        <a href="{{ url_for('shopkeeper.profile_edit') }}" 
           class="bg-white rounded-xl shadow-lg p-6 text-center hover:shadow-xl transform hover:-translate-y-1 transition-all duration-300 border border-gray-200">
            <div class="w-12 h-12 bg-orange-100 rounded-full flex items-center justify-center mx-auto mb-3">
                <i data-feather="edit-3" class="w-6 h-6 text-orange-600"></i>
            </div>
            <h3 class="font-semibold text-gray-800 mb-1">Edit Profile</h3>
            <p class="text-xs text-gray-600">Update information</p>
        </a>
    </div>

    <!-- Business Information Section -->
    <div class="bg-white rounded-2xl p-8 shadow-xl border border-orange-100 fade-in-up mb-8">
        <div class="flex items-center mb-6">
            <div class="p-3 bg-orange-100 rounded-xl shadow-lg">
                <i data-feather="briefcase" class="w-6 h-6 text-orange-600"></i>
            </div>
            <h2 class="text-2xl font-bold text-gray-800 ml-4">Business Information</h2>
        </div>
        
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- Basic Business Info -->
            <div class="space-y-4">
                <div class="info-card p-4 bg-orange-50 rounded-xl border-l-4 border-orange-600">
                    <label class="block text-sm font-medium text-orange-700 mb-1">Shop Name</label>
                    <p class="text-gray-900 font-semibold">{{ shopkeeper.shop_name or 'Not specified' }}</p>
                </div>
                
                <div class="info-card p-4 bg-orange-50 rounded-xl border-l-4 border-orange-600">
                    <label class="block text-sm font-medium text-orange-700 mb-1">Business Type</label>
                    <p class="text-gray-900">{{ shopkeeper.business_type or shopkeeper.domain or 'Not specified' }}</p>
                </div>
                
                <div class="info-card p-4 bg-orange-50 rounded-xl border-l-4 border-orange-600">
                    <label class="block text-sm font-medium text-orange-700 mb-1">Established Year</label>
                    <p class="text-gray-900">{{ shopkeeper.established_year or 'Not specified' }}</p>
                </div>
                
                <div class="info-card p-4 bg-orange-50 rounded-xl border-l-4 border-orange-600">
                    <label class="block text-sm font-medium text-orange-700 mb-1">GST Number</label>
                    <p class="text-gray-900">{{ shopkeeper.gst_number or 'Not registered' }}</p>
                </div>
            </div>
            
            <!-- Contact & Location -->
            <div class="space-y-4">
                <div class="info-card p-4 bg-blue-50 rounded-xl border-l-4 border-blue-600">
                    <label class="block text-sm font-medium text-blue-700 mb-1">Contact Number</label>
                    <p class="text-gray-900">{{ shopkeeper.contact_number or 'Not specified' }}</p>
                </div>
                
                <div class="info-card p-4 bg-blue-50 rounded-xl border-l-4 border-blue-600">
                    <label class="block text-sm font-medium text-blue-700 mb-1">Business Address</label>
                    <p class="text-gray-900">{{ shopkeeper.business_address or shopkeeper.address or 'Not specified' }}</p>
                </div>
                
                <div class="info-card p-4 bg-blue-50 rounded-xl border-l-4 border-blue-600">
                    <label class="block text-sm font-medium text-blue-700 mb-1">Location</label>
                    <p class="text-gray-900">
                        {% if shopkeeper.city or shopkeeper.state or shopkeeper.pincode %}
                            {{ shopkeeper.city or '' }}{{ ', ' if shopkeeper.city and shopkeeper.state else '' }}{{ shopkeeper.state or '' }}{{ ' - ' if (shopkeeper.city or shopkeeper.state) and shopkeeper.pincode else '' }}{{ shopkeeper.pincode or '' }}
                        {% else %}
                            Not specified
                        {% endif %}
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Personal Information Grid -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
        <!-- Personal Details -->
        <div class="bg-white rounded-2xl p-8 shadow-xl border border-green-100 fade-in-up">
            <div class="flex items-center mb-6">
                <div class="p-3 bg-green-100 rounded-xl shadow-lg">
                    <i data-feather="user" class="w-6 h-6 text-green-600"></i>
                </div>
                <h2 class="text-2xl font-bold text-gray-800 ml-4">Personal Details</h2>
            </div>
            
            <div class="space-y-4">
                <div class="info-card p-4 bg-green-50 rounded-xl border-l-4 border-green-600">
                    <label class="block text-sm font-medium text-green-700 mb-1">Owner Name</label>
                    <p class="text-gray-900">{{ shopkeeper.owner_name or 'Not specified' }}</p>
                </div>
                
                <div class="info-card p-4 bg-green-50 rounded-xl border-l-4 border-green-600">
                    <label class="block text-sm font-medium text-green-700 mb-1">Email Address</label>
                    <p class="text-gray-900">{{ shopkeeper.user.email or 'Not specified' }}</p>
                </div>
                
                <div class="info-card p-4 bg-green-50 rounded-xl border-l-4 border-green-600">
                    <label class="block text-sm font-medium text-green-700 mb-1">PAN Number</label>
                    <p class="text-gray-900">{{ shopkeeper.pan_number or 'Not specified' }}</p>
                </div>
                
                <div class="info-card p-4 bg-green-50 rounded-xl border-l-4 border-green-600">
                    <label class="block text-sm font-medium text-green-700 mb-1">Owner Address</label>
                    <p class="text-gray-900">{{ shopkeeper.owner_address or 'Not specified' }}</p>
                </div>
            </div>
        </div>

        <!-- Banking Details -->
        <div class="bg-white rounded-2xl p-8 shadow-xl border border-purple-100 fade-in-up">
            <div class="flex items-center mb-6">
                <div class="p-3 bg-purple-100 rounded-xl shadow-lg">
                    <i data-feather="credit-card" class="w-6 h-6 text-purple-600"></i>
                </div>
                <h2 class="text-2xl font-bold text-gray-800 ml-4">Banking Details</h2>
            </div>
            
            <div class="space-y-4">
                <div class="info-card p-4 bg-purple-50 rounded-xl border-l-4 border-purple-600">
                    <label class="block text-sm font-medium text-purple-700 mb-1">Bank Name</label>
                    <p class="text-gray-900">{{ shopkeeper.bank_name or 'Not specified' }}</p>
                </div>
                
                <div class="info-card p-4 bg-purple-50 rounded-xl border-l-4 border-purple-600">
                    <label class="block text-sm font-medium text-purple-700 mb-1">Account Number</label>
                    <p class="text-gray-900">{{ shopkeeper.account_number or 'Not specified' }}</p>
                </div>
                
                <div class="info-card p-4 bg-purple-50 rounded-xl border-l-4 border-purple-600">
                    <label class="block text-sm font-medium text-purple-700 mb-1">IFSC Code</label>
                    <p class="text-gray-900">{{ shopkeeper.ifsc_code or 'Not specified' }}</p>
                </div>
                
                <div class="info-card p-4 bg-purple-50 rounded-xl border-l-4 border-purple-600">
                    <label class="block text-sm font-medium text-purple-700 mb-1">UPI ID</label>
                    <p class="text-gray-900">{{ shopkeeper.upi_id or 'Not specified' }}</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Bill Settings Section -->
    <div class="bg-white rounded-2xl p-8 shadow-xl border border-indigo-100 fade-in-up mb-8">
        <div class="flex items-center mb-8">
            <div class="p-3 bg-indigo-100 rounded-xl shadow-lg">
                <i data-feather="settings" class="w-6 h-6 text-indigo-600"></i>
            </div>
            <h2 class="text-2xl font-bold text-gray-800 ml-4">Bill & Invoice Settings</h2>
        </div>
        

        <!-- Quick Settings Actions -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- Template Preview Card -->
            <div class="group bg-gradient-to-br from-gray-50 to-gray-100 rounded-xl p-6 border border-gray-200 hover:border-indigo-300 transition-all duration-300 hover:shadow-lg">
                <!-- Mobile Layout (Vertical) -->
                <div class="flex flex-col lg:hidden space-y-4">
                    <!-- Template Info -->
                    <div>
                        <div class="flex items-center mb-3">
                            <div class="w-10 h-10 bg-indigo-100 rounded-lg flex items-center justify-center mr-3 group-hover:bg-indigo-200 transition-colors">
                                <i data-feather="eye" class="w-5 h-5 text-indigo-600"></i>
                            </div>
                            <div>
                                <h4 class="font-semibold text-gray-800">Template Preview</h4>
                                <p class="text-sm text-gray-600">Current bill design</p>
                            </div>
                        </div>
                        
                        <div class="mb-4">
                            <div class="text-sm text-gray-600 mb-1">Selected Template:</div>
                            <div class="font-medium text-gray-800 text-lg">
                                {% if shopkeeper.template_choice == 'template1' %}
                                    Basic Template
                                {% elif shopkeeper.template_choice == 'template3' %}
                                    Modern Template
                                {% else %}
                                    Professional Template
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    
                    <!-- Template Preview Image (Mobile) -->
                    <div class="flex justify-center">
                        <div class="w-54 h-58 bg-white rounded-lg shadow-md border border-gray-200 overflow-hidden">
                            <img src="{{ url_for('static', filename='images/bill-templates/' + (
                                'basic-bill-template.png' if shopkeeper.template_choice == 'template1' else
                                'modern-bill-template.png' if shopkeeper.template_choice == 'template3' else
                                'professional-bill-template.png'
                            )) }}" 
                                 alt="Template Preview" 
                                 class="w-full h-full object-contain"
                                 onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                            <div class="w-full h-full hidden items-center justify-center bg-gray-100 text-gray-400 text-xs">
                                <i data-feather="image" class="w-8 h-8"></i>
                            </div>
                        </div>
                    </div>
                    <p class="text-xs text-gray-500 text-center">Preview</p>
                    
                    <!-- Configure Button -->
                    <div>
                        <button onclick="openTemplateModal()" 
                               class="w-full bg-indigo-50 hover:bg-indigo-100 text-indigo-700 font-medium py-3 px-4 rounded-lg transition-colors text-sm inline-flex items-center justify-center cursor-pointer border-none">
                            <i data-feather="settings" class="w-4 h-4 mr-2"></i>
                            Configure Template
                        </button>
                    </div>
                </div>
                
                <!-- Desktop Layout (Horizontal) -->
                <div class="hidden lg:flex items-center justify-between h-full min-h-[200px]">
                    <!-- Left Side - Template Info -->
                    <div class="flex-1 min-w-0 flex flex-col justify-between h-full py-2">
                        <div>
                            <div class="flex items-center mb-3">
                                <div class="w-10 h-10 bg-indigo-100 rounded-lg flex items-center justify-center mr-3 group-hover:bg-indigo-200 transition-colors">
                                    <i data-feather="eye" class="w-5 h-5 text-indigo-600"></i>
                                </div>
                                <div>
                                    <h4 class="font-semibold text-gray-800">Template Preview</h4>
                                    <p class="text-sm text-gray-600">Current bill design</p>
                                </div>
                            </div>
                            
                            <div class="mb-6">
                                <div class="text-sm text-gray-600 mb-1">Selected Template:</div>
                                <div class="font-medium text-gray-800 text-lg">
                                    {% if shopkeeper.template_choice == 'template1' %}
                                        Basic Template
                                    {% elif shopkeeper.template_choice == 'template3' %}
                                        Modern Template
                                    {% else %}
                                        Professional Template
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        
                        <div>
                            <button onclick="openTemplateModal()" 
                                   class="bg-indigo-50 hover:bg-indigo-100 text-indigo-700 font-medium py-2 px-4 rounded-lg transition-colors text-sm inline-flex items-center cursor-pointer border-none">
                                <i data-feather="settings" class="w-4 h-4 mr-2"></i>
                                Configure Template
                            </button>
                        </div>
                    </div>
                    
                    <!-- Right Side - Template Preview Image (Desktop) -->
                    <div class="flex-shrink-0 ml-6">
                        <div class="w-54 h-58 bg-white rounded-lg shadow-md border border-gray-200 overflow-hidden">
                            <img src="{{ url_for('static', filename='images/bill-templates/' + (
                                'basic-bill-template.png' if shopkeeper.template_choice == 'template1' else
                                'modern-bill-template.png' if shopkeeper.template_choice == 'template3' else
                                'professional-bill-template.png'
                            )) }}" 
                                 alt="Template Preview" 
                                 class="w-full h-full object-contain"
                                 onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                            <div class="w-full h-full hidden items-center justify-center bg-gray-100 text-gray-400 text-xs">
                                <i data-feather="image" class="w-8 h-8"></i>
                            </div>
                        </div>
                        <p class="text-xs text-gray-500 text-center mt-2">Preview</p>
                    </div>
                </div>
            </div>

            <!-- Numbering Settings Card -->
            <div class="group bg-gradient-to-br from-gray-50 to-gray-100 rounded-xl p-6 border border-gray-200 hover:border-emerald-300 transition-all duration-300 hover:shadow-lg min-h-[200px] lg:min-h-[240px]">
                <div class="flex flex-col h-full">
                    <!-- Header -->
                    <div class="flex items-center mb-4">
                        <div class="w-10 h-10 bg-emerald-100 rounded-lg flex items-center justify-center mr-3 group-hover:bg-emerald-200 transition-colors">
                            <i data-feather="edit-3" class="w-5 h-5 text-emerald-600"></i>
                        </div>
                        <div>
                            <h4 class="font-semibold text-gray-800">Numbering Config</h4>
                            <p class="text-sm text-gray-600">Customize invoice numbers</p>
                        </div>
                    </div>
                    
                    <!-- Content -->
                    <div class="flex-1 flex flex-col justify-between">
                        <div class="bg-white rounded-lg p-4 border border-gray-200 mb-4">
                            <div class="flex items-center justify-between text-sm mb-3">
                                <span class="text-gray-600">Mode:</span>
                                <span class="font-medium text-gray-800">
                                    {% if shopkeeper.invoice_prefix and shopkeeper.invoice_prefix.strip() %}Custom{% else %}Automatic{% endif %}
                                </span>
                            </div>
                            {% if shopkeeper.invoice_prefix and shopkeeper.invoice_prefix.strip() %}
                            <div class="bg-emerald-50 rounded-lg p-3 text-center">
                                <span class="font-mono text-emerald-800 font-bold text-sm">{{ preview_next_invoice_number(shopkeeper) }}</span>
                                <p class="text-xs text-emerald-600 mt-1">Next invoice number</p>
                            </div>
                            {% else %}
                            <div class="bg-blue-50 rounded-lg p-3 text-center">
                                <span class="font-mono text-blue-800 font-bold text-sm">BILL123456789</span>
                                <p class="text-xs text-blue-600 mt-1">Timestamp-based</p>
                            </div>
                            {% endif %}
                        </div>
                        
                        <!-- Configure Button -->
                        <button onclick="openInvoiceModal()" 
                               class="w-full bg-emerald-50 hover:bg-emerald-100 text-emerald-700 font-medium py-3 px-4 rounded-lg transition-colors text-sm inline-flex items-center justify-center cursor-pointer border-none">
                            <i data-feather="settings" class="w-4 h-4 mr-2"></i>
                            Configure Settings
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Documents Section -->
    <div class="bg-white rounded-2xl p-8 shadow-xl border border-indigo-100 fade-in-up mb-8">
        <div class="flex items-center mb-8">
            <div class="p-3 bg-indigo-100 rounded-xl shadow-lg">
                <i data-feather="folder" class="w-6 h-6 text-indigo-600"></i>
            </div>
            <h2 class="text-2xl font-bold text-gray-800 ml-4">Business Documents</h2>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <!-- GST Certificate -->
            <div class="document-card p-6 bg-gray-50 rounded-xl">
                <div class="flex items-center justify-between mb-4">
                    <div class="flex items-center">
                        <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center mr-3">
                            <i data-feather="award" class="w-5 h-5 text-blue-600"></i>
                        </div>
                        <div>
                            <h3 class="font-semibold text-gray-800">GST Certificate</h3>
                            <p class="text-xs text-gray-600">Tax registration</p>
                        </div>
                    </div>
                    {% if shopkeeper.gst_doc_path %}
                    <span class="bg-green-100 text-green-800 text-xs px-2 py-1 rounded-full">Uploaded</span>
                    {% else %}
                    <span class="bg-red-100 text-red-800 text-xs px-2 py-1 rounded-full">Missing</span>
                    {% endif %}
                </div>
                {% if shopkeeper.gst_doc_path %}
                <a href="{{ url_for('static', filename=shopkeeper.gst_doc_path) }}" 
                   target="_blank" 
                   class="inline-flex items-center text-blue-600 hover:text-blue-800 text-sm">
                    <i data-feather="external-link" class="w-4 h-4 mr-1"></i>
                    View Document
                </a>
                {% else %}
                <p class="text-gray-500 text-sm">No document uploaded</p>
                {% endif %}
            </div>

            <!-- PAN Card -->
            <div class="document-card p-6 bg-gray-50 rounded-xl">
                <div class="flex items-center justify-between mb-4">
                    <div class="flex items-center">
                        <div class="w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center mr-3">
                            <i data-feather="credit-card" class="w-5 h-5 text-green-600"></i>
                        </div>
                        <div>
                            <h3 class="font-semibold text-gray-800">PAN Card</h3>
                            <p class="text-xs text-gray-600">Tax identification</p>
                        </div>
                    </div>
                    {% if shopkeeper.pan_doc_path %}
                    <span class="bg-green-100 text-green-800 text-xs px-2 py-1 rounded-full">Uploaded</span>
                    {% else %}
                    <span class="bg-red-100 text-red-800 text-xs px-2 py-1 rounded-full">Missing</span>
                    {% endif %}
                </div>
                {% if shopkeeper.pan_doc_path %}
                <a href="{{ url_for('static', filename=shopkeeper.pan_doc_path) }}" 
                   target="_blank" 
                   class="inline-flex items-center text-blue-600 hover:text-blue-800 text-sm">
                    <i data-feather="external-link" class="w-4 h-4 mr-1"></i>
                    View Document
                </a>
                {% else %}
                <p class="text-gray-500 text-sm">No document uploaded</p>
                {% endif %}
            </div>

            <!-- Address Proof -->
            <div class="document-card p-6 bg-gray-50 rounded-xl">
                <div class="flex items-center justify-between mb-4">
                    <div class="flex items-center">
                        <div class="w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center mr-3">
                            <i data-feather="map-pin" class="w-5 h-5 text-purple-600"></i>
                        </div>
                        <div>
                            <h3 class="font-semibold text-gray-800">Address Proof</h3>
                            <p class="text-xs text-gray-600">Business address</p>
                        </div>
                    </div>
                    {% if shopkeeper.address_proof_path %}
                    <span class="bg-green-100 text-green-800 text-xs px-2 py-1 rounded-full">Uploaded</span>
                    {% else %}
                    <span class="bg-red-100 text-red-800 text-xs px-2 py-1 rounded-full">Missing</span>
                    {% endif %}
                </div>
                {% if shopkeeper.address_proof_path %}
                <a href="{{ url_for('static', filename=shopkeeper.address_proof_path) }}" 
                   target="_blank" 
                   class="inline-flex items-center text-blue-600 hover:text-blue-800 text-sm">
                    <i data-feather="external-link" class="w-4 h-4 mr-1"></i>
                    View Document
                </a>
                {% else %}
                <p class="text-gray-500 text-sm">No document uploaded</p>
                {% endif %}
            </div>

            <!-- Aadhaar/DL -->
            <div class="document-card p-6 bg-gray-50 rounded-xl">
                <div class="flex items-center justify-between mb-4">
                    <div class="flex items-center">
                        <div class="w-10 h-10 bg-yellow-100 rounded-lg flex items-center justify-center mr-3">
                            <i data-feather="user-check" class="w-5 h-5 text-yellow-600"></i>
                        </div>
                        <div>
                            <h3 class="font-semibold text-gray-800">Aadhaar/DL</h3>
                            <p class="text-xs text-gray-600">Identity proof</p>
                        </div>
                    </div>
                    {% if shopkeeper.aadhaar_dl_path %}
                    <span class="bg-green-100 text-green-800 text-xs px-2 py-1 rounded-full">Uploaded</span>
                    {% else %}
                    <span class="bg-red-100 text-red-800 text-xs px-2 py-1 rounded-full">Missing</span>
                    {% endif %}
                </div>
                {% if shopkeeper.aadhaar_dl_path %}
                <a href="{{ url_for('static', filename=shopkeeper.aadhaar_dl_path) }}" 
                   target="_blank" 
                   class="inline-flex items-center text-blue-600 hover:text-blue-800 text-sm">
                    <i data-feather="external-link" class="w-4 h-4 mr-1"></i>
                    View Document
                </a>
                {% else %}
                <p class="text-gray-500 text-sm">No document uploaded</p>
                {% endif %}
            </div>

            <!-- Selfie Photo -->
            <div class="document-card p-6 bg-gray-50 rounded-xl">
                <div class="flex items-center justify-between mb-4">
                    <div class="flex items-center">
                        <div class="w-10 h-10 bg-pink-100 rounded-lg flex items-center justify-center mr-3">
                            <i data-feather="camera" class="w-5 h-5 text-pink-600"></i>
                        </div>
                        <div>
                            <h3 class="font-semibold text-gray-800">Owner Selfie</h3>
                            <p class="text-xs text-gray-600">Photo verification</p>
                        </div>
                    </div>
                    {% if shopkeeper.selfie_path %}
                    <span class="bg-green-100 text-green-800 text-xs px-2 py-1 rounded-full">Uploaded</span>
                    {% else %}
                    <span class="bg-red-100 text-red-800 text-xs px-2 py-1 rounded-full">Missing</span>
                    {% endif %}
                </div>
                {% if shopkeeper.selfie_path %}
                <a href="{{ url_for('static', filename=shopkeeper.selfie_path) }}" 
                   target="_blank" 
                   class="inline-flex items-center text-blue-600 hover:text-blue-800 text-sm">
                    <i data-feather="external-link" class="w-4 h-4 mr-1"></i>
                    View Photo
                </a>
                {% else %}
                <p class="text-gray-500 text-sm">No photo uploaded</p>
                {% endif %}
            </div>

            <!-- Gumasta License -->
            <div class="document-card p-6 bg-gray-50 rounded-xl">
                <div class="flex items-center justify-between mb-4">
                    <div class="flex items-center">
                        <div class="w-10 h-10 bg-red-100 rounded-lg flex items-center justify-center mr-3">
                            <i data-feather="file-text" class="w-5 h-5 text-red-600"></i>
                        </div>
                        <div>
                            <h3 class="font-semibold text-gray-800">Gumasta License</h3>
                            <p class="text-xs text-gray-600">Business license</p>
                        </div>
                    </div>
                    {% if shopkeeper.gumasta_path %}
                    <span class="bg-green-100 text-green-800 text-xs px-2 py-1 rounded-full">Uploaded</span>
                    {% else %}
                    <span class="bg-red-100 text-red-800 text-xs px-2 py-1 rounded-full">Missing</span>
                    {% endif %}
                </div>
                {% if shopkeeper.gumasta_path %}
                <a href="{{ url_for('static', filename=shopkeeper.gumasta_path) }}" 
                   target="_blank" 
                   class="inline-flex items-center text-blue-600 hover:text-blue-800 text-sm">
                    <i data-feather="external-link" class="w-4 h-4 mr-1"></i>
                    View Document
                </a>
                {% else %}
                <p class="text-gray-500 text-sm">No document uploaded</p>
                {% endif %}
            </div>

            <!-- Udyam Registration -->
            <div class="document-card p-6 bg-gray-50 rounded-xl">
                <div class="flex items-center justify-between mb-4">
                    <div class="flex items-center">
                        <div class="w-10 h-10 bg-orange-100 rounded-lg flex items-center justify-center mr-3">
                            <i data-feather="briefcase" class="w-5 h-5 text-orange-600"></i>
                        </div>
                        <div>
                            <h3 class="font-semibold text-gray-800">Udyam Registration</h3>
                            <p class="text-xs text-gray-600">MSME certificate</p>
                        </div>
                    </div>
                    {% if shopkeeper.udyam_path %}
                    <span class="bg-green-100 text-green-800 text-xs px-2 py-1 rounded-full">Uploaded</span>
                    {% else %}
                    <span class="bg-red-100 text-red-800 text-xs px-2 py-1 rounded-full">Missing</span>
                    {% endif %}
                </div>
                {% if shopkeeper.udyam_path %}
                <a href="{{ url_for('static', filename=shopkeeper.udyam_path) }}" 
                   target="_blank" 
                   class="inline-flex items-center text-blue-600 hover:text-blue-800 text-sm">
                    <i data-feather="external-link" class="w-4 h-4 mr-1"></i>
                    View Document
                </a>
                {% else %}
                <p class="text-gray-500 text-sm">No document uploaded</p>
                {% endif %}
            </div>

            <!-- Bank Statement -->
            <div class="document-card p-6 bg-gray-50 rounded-xl">
                <div class="flex items-center justify-between mb-4">
                    <div class="flex items-center">
                        <div class="w-10 h-10 bg-indigo-100 rounded-lg flex items-center justify-center mr-3">
                            <i data-feather="trending-up" class="w-5 h-5 text-indigo-600"></i>
                        </div>
                        <div>
                            <h3 class="font-semibold text-gray-800">Bank Statement</h3>
                            <p class="text-xs text-gray-600">Financial proof</p>
                        </div>
                    </div>
                    {% if shopkeeper.bank_statement_path %}
                    <span class="bg-green-100 text-green-800 text-xs px-2 py-1 rounded-full">Uploaded</span>
                    {% else %}
                    <span class="bg-red-100 text-red-800 text-xs px-2 py-1 rounded-full">Missing</span>
                    {% endif %}
                </div>
                {% if shopkeeper.bank_statement_path %}
                <a href="{{ url_for('static', filename=shopkeeper.bank_statement_path) }}" 
                   target="_blank" 
                   class="inline-flex items-center text-blue-600 hover:text-blue-800 text-sm">
                    <i data-feather="external-link" class="w-4 h-4 mr-1"></i>
                    View Document
                </a>
                {% else %}
                <p class="text-gray-500 text-sm">No document uploaded</p>
                {% endif %}
            </div>

            <!-- Business Logo -->
            <div class="document-card p-6 bg-gray-50 rounded-xl">
                <div class="flex items-center justify-between mb-4">
                    <div class="flex items-center">
                        <div class="w-10 h-10 bg-cyan-100 rounded-lg flex items-center justify-center mr-3">
                            <i data-feather="image" class="w-5 h-5 text-cyan-600"></i>
                        </div>
                        <div>
                            <h3 class="font-semibold text-gray-800">Business Logo</h3>
                            <p class="text-xs text-gray-600">Brand identity</p>
                        </div>
                    </div>
                    {% if shopkeeper.logo_path %}
                    <span class="bg-green-100 text-green-800 text-xs px-2 py-1 rounded-full">Uploaded</span>
                    {% else %}
                    <span class="bg-red-100 text-red-800 text-xs px-2 py-1 rounded-full">Missing</span>
                    {% endif %}
                </div>
                {% if shopkeeper.logo_path %}
                <a href="{{ url_for('static', filename=shopkeeper.logo_path) }}" 
                   target="_blank" 
                   class="inline-flex items-center text-blue-600 hover:text-blue-800 text-sm">
                    <i data-feather="external-link" class="w-4 h-4 mr-1"></i>
                    View Logo
                </a>
                {% else %}
                <p class="text-gray-500 text-sm">No logo uploaded</p>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Action Button -->
    <div class="text-center mb-8">
        <a href="{{ url_for('shopkeeper.profile_edit') }}" 
           class="inline-flex items-center px-8 py-4 bg-orange-200 text-orange-600 rounded-2xl shadow-lg hover:shadow-xl transform hover:-translate-y-1 transition-all duration-300 text-lg font-medium hover:from-orange-600 hover:to-orange-700">
            <i data-feather="edit-3" class="w-5 h-5 mr-2"></i>
            Edit Profile
        </a>
    </div>
</div>

<!-- Invoice Configuration Modal -->
<div id="invoiceModal" class="fixed inset-0 backdrop-blur-sm bg-black/20 hidden flex items-center justify-center z-50 p-4">
    <div class="bg-white rounded-2xl shadow-2xl w-full max-w-md mx-auto transform transition-all duration-300 scale-95 opacity-0" id="invoiceModalContent">
        <!-- Modal Header -->
        <div class="bg-emerald-200 text-emerald-600 rounded-t-2xl px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center">
                    <div class="w-8 h-8 bg-white/30 rounded-lg flex items-center justify-center mr-3">
                        <i data-feather="edit-3" class="w-4 h-4"></i>
                    </div>
                    <h3 class="text-lg font-semibold">Invoice Number Configuration</h3>
                </div>
                <button onclick="closeInvoiceModal()" class="text-white/80 hover:text-white transition-colors">
                    <i data-feather="x" class="w-5 h-5"></i>
                </button>
            </div>
        </div>
        
        <!-- Modal Body -->
        <form id="invoiceConfigForm" class="p-6 space-y-6">
            <div class="space-y-4">
                <!-- Invoice Prefix -->
                <div>
                    <label for="modal_invoice_prefix" class="block text-sm font-medium text-gray-700 mb-2">
                        <i data-feather="tag" class="w-4 h-4 inline mr-2 text-emerald-600"></i>
                        Invoice Prefix (Optional)
                    </label>
                    <input type="text" 
                           id="modal_invoice_prefix" 
                           name="invoice_prefix" 
                           value="{{ shopkeeper.invoice_prefix or '' }}"
                           placeholder="e.g., INV, BILL" 
                           class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition-all duration-200 text-sm bg-gray-50 hover:bg-white"
                           maxlength="10">
                    <p class="text-xs text-gray-500 mt-1">Leave empty for automatic timestamp-based numbering</p>
                </div>
                
                <!-- Starting Number -->
                <div>
                    <label for="modal_invoice_starting_number" class="block text-sm font-medium text-gray-700 mb-2">
                        <i data-feather="hash" class="w-4 h-4 inline mr-2 text-emerald-600"></i>
                        Starting Number
                    </label>
                    <input type="number" 
                           id="modal_invoice_starting_number" 
                           name="invoice_starting_number" 
                           value="{{ shopkeeper.invoice_starting_number or 1 }}"
                           placeholder="1" 
                           min="1" 
                           max="999999"
                           class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition-all duration-200 text-sm bg-gray-50 hover:bg-white">
                    <p class="text-xs text-gray-500 mt-1">Next invoice will start from this number</p>
                </div>
            </div>
            
            <!-- Preview Section -->
            <div class="bg-gradient-to-br from-gray-50 to-gray-100 rounded-xl p-4 border border-gray-200">
                <h4 class="text-sm font-medium text-gray-700 mb-3 flex items-center">
                    <i data-feather="eye" class="w-4 h-4 mr-2 text-emerald-600"></i>
                    Preview
                </h4>
                <div class="space-y-2">
                    <div class="flex justify-between items-center text-sm">
                        <span class="text-gray-600">Current:</span>
                        <span id="current-preview" class="font-mono font-bold text-emerald-700 bg-white px-2 py-1 rounded">{{ preview_next_invoice_number(shopkeeper) if shopkeeper.invoice_prefix and shopkeeper.invoice_prefix.strip() else 'BILL' + moment().format('X') }}</span>
                    </div>
                    <div class="flex justify-between items-center text-sm">
                        <span class="text-gray-600">Next:</span>
                        <span id="next-preview" class="font-mono font-bold text-blue-700 bg-white px-2 py-1 rounded">Will be generated</span>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex space-x-3 pt-4">
                <button type="button" 
                        onclick="closeInvoiceModal()" 
                        class="flex-1 px-4 py-3 bg-gray-100 hover:bg-gray-200 text-gray-700 font-medium rounded-xl transition-colors text-sm cursor-pointer">
                    Cancel
                </button>
                <button type="submit" 
                        class="flex-1 px-4 py-3 bg-emerald-200 text-emerald-600 hover:bg-emerald-300 font-medium rounded-xl transition-all duration-200 text-sm shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 cursor-pointer">
                    <i data-feather="save" class="w-4 h-4 inline mr-2"></i>
                    Save Settings
                </button>
            </div>
        </form>
    </div>
</div>


<!-- Template Configuration Modal -->
<div id="templateModal" class="fixed inset-0 backdrop-blur-sm hidden flex items-center justify-center z-50">
    <div id="templateModalContent" class="bg-white rounded-xl shadow-2xl max-w-4xl w-full mx-4 max-h-[90vh] overflow-y-auto scale-95 opacity-0 transition-all duration-300">
        <!-- Modal Header -->
        <div class="bg-blue-200 text-blue-600 p-4 rounded-t-xl">
            <div class="flex items-center justify-between">
                <div class="flex items-center">
                    <div class="w-8 h-8 bg-white/20 rounded-lg flex items-center justify-center mr-3">
                        <i data-feather="settings" class="w-5 h-5"></i>
                    </div>
                    <div>
                        <h3 class="text-xl font-bold">Template Configuration</h3>
                        <!-- <p class="text-indigo-100 text-sm">Choose your preferred bill template design</p> -->
                    </div>
                </div>
                <button onclick="closeTemplateModal()" 
                        class="text-white hover:bg-white/20 p-2 rounded-lg transition-colors">
                    <i data-feather="x" class="w-5 h-5"></i>
                </button>
            </div>
        </div>
        
        <!-- Modal Body -->
        <div class="p-6">
            <form id="templateConfigForm">
                <!-- Template Options Grid -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-6">
                    <!-- Template Selection -->
                    <div>
                        <h4 class="text-lg font-semibold text-gray-800 mb-4">Available Templates</h4>
                        <div class="space-y-4">
                            <!-- Basic Template -->
                            <div class="template-option border border-gray-300 rounded-lg p-4 cursor-pointer hover:border-indigo-300 transition-colors" data-template="template1">
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center">
                                        <input type="radio" id="template1" name="template_choice" value="template1" 
                                               {{ 'checked' if shopkeeper.template_choice == 'template1' else '' }}
                                               class="w-4 h-4 text-blue-600 mr-3">
                                        <div>
                                            <label for="template1" class="text-sm font-medium text-gray-900 cursor-pointer">Basic Template</label>
                                            <p class="text-xs text-gray-500">Simple and clean design</p>
                                        </div>
                                    </div>
                                    <div class="w-16 h-20 bg-gray-100 rounded border overflow-hidden">
                                        <img src="{{ url_for('static', filename='images/bill-templates/basic-bill-template.png') }}"
                                             alt="Basic Template" class="w-full h-full object-contain">
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Professional Template -->
                            <div class="template-option border border-gray-300 rounded-lg p-4 cursor-pointer hover:border-indigo-300 transition-colors" data-template="template2">
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center">
                                        <input type="radio" id="template2" name="template_choice" value="template2" 
                                               {{ 'checked' if shopkeeper.template_choice == 'template2' or not shopkeeper.template_choice else '' }}
                                               class="w-4 h-4 text-blue-600 mr-3">
                                        <div>
                                            <label for="template2" class="text-sm font-medium text-gray-900 cursor-pointer">Professional Template</label>
                                            <p class="text-xs text-gray-500">Elegant design with advanced formatting</p>
                                        </div>
                                    </div>
                                    <div class="w-16 h-20 bg-gray-100 rounded border overflow-hidden">
                                        <img src="{{ url_for('static', filename='images/bill-templates/professional-bill-template.png') }}"
                                             alt="Professional Template" class="w-full h-full object-contain">
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Modern Template -->
                            <div class="template-option border border-gray-300 rounded-lg p-4 cursor-pointer hover:border-indigo-300 transition-colors" data-template="template3">
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center">
                                        <input type="radio" id="template3" name="template_choice" value="template3" 
                                               {{ 'checked' if shopkeeper.template_choice == 'template3' else '' }}
                                               class="w-4 h-4 text-blue-600 mr-3">
                                        <div>
                                            <label for="template3" class="text-sm font-medium text-gray-900 cursor-pointer">Modern Template</label>
                                            <p class="text-xs text-gray-500">Contemporary design with modern elements</p>
                                        </div>
                                    </div>
                                    <div class="w-16 h-20 bg-gray-100 rounded border overflow-hidden">
                                        <img src="{{ url_for('static', filename='images/bill-templates/modern-bill-template.png') }}"
                                             alt="Modern Template" class="w-full h-full object-contain">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Live Preview -->
                    <div>
                        <h4 class="text-lg font-semibold text-gray-800 mb-4">Live Preview</h4>
                        <div class="bg-gray-50 rounded-lg p-6 border border-gray-200">
                            <!-- Preview Loading -->
                            <div id="previewLoading" class="hidden text-center py-8">
                                <div class="animate-spin inline-block w-6 h-6 border-2 border-indigo-500 border-t-transparent rounded-full"></div>
                                <p class="text-sm text-gray-600 mt-2">Loading preview...</p>
                            </div>
                            
                            <!-- Preview Image -->
                            <div class="text-center">
                                <div class="inline-block bg-white rounded-lg shadow-lg p-4 border">
                                    <img id="templatePreviewImage" 
                                         src="{{ url_for('static', filename='images/bill-templates/' + (
                                             'basic-bill-template.png' if shopkeeper.template_choice == 'template1' else
                                             'modern-bill-template.png' if shopkeeper.template_choice == 'template3' else
                                             'professional-bill-template.png'
                                         )) }}" 
                                         alt="Template Preview" 
                                         class="w-64 h-56 object-cover rounded">
                                </div>
                                <div class="mt-4">
                                    <h5 id="previewTitle" class="font-semibold text-gray-800">
                                        {% if shopkeeper.template_choice == 'template1' %}
                                            Basic Template
                                        {% elif shopkeeper.template_choice == 'template3' %}
                                            Modern Template
                                        {% else %}
                                            Professional Template
                                        {% endif %}
                                    </h5>
                                    <p id="previewDescription" class="text-sm text-gray-600">
                                        {% if shopkeeper.template_choice == 'template1' %}
                                            Simple and clean design
                                        {% elif shopkeeper.template_choice == 'template3' %}
                                            Contemporary design with modern elements
                                        {% else %}
                                            Elegant design with advanced formatting
                                        {% endif %}
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Modal Footer -->
                <div class="flex items-center justify-between pt-6 border-t border-gray-200">
                    <div class="text-sm text-gray-600 hidden lg:block">
                        <i data-feather="info" class="w-4 h-4 inline mr-1"></i>
                        Choose a template that best represents your business style
                    </div>
                    <div class="flex space-x-3 lg:ml-0 ml-auto">
                        <button type="button" 
                                onclick="closeTemplateModal()" 
                                class="px-4 py-2 text-gray-600 hover:text-gray-800 font-medium transition-colors cursor-pointer">
                            Cancel
                        </button>
                        <button type="button" 
                                onclick="saveTemplateConfig()" 
                                class="bg-blue-200 hover:bg-blue-300 text-blue-600 px-6 py-2 rounded-lg font-medium transition-colors flex items-center cursor-pointer">
                            <i data-feather="check" class="w-4 h-4 mr-2"></i>
                            Save Template
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
    // Invoice Modal Functions
    function openInvoiceModal() {
        const modal = document.getElementById('invoiceModal');
        const modalContent = document.getElementById('invoiceModalContent');
        
        modal.classList.remove('hidden');
        
        // Animate modal in
        setTimeout(() => {
            modalContent.classList.remove('scale-95', 'opacity-0');
            modalContent.classList.add('scale-100', 'opacity-100');
        }, 10);
        
        // Update preview on load
        updateInvoicePreview();
        
        // Re-initialize feather icons
        feather.replace();
    }
    
    function closeInvoiceModal() {
        const modal = document.getElementById('invoiceModal');
        const modalContent = document.getElementById('invoiceModalContent');
        
        // Animate modal out
        modalContent.classList.add('scale-95', 'opacity-0');
        modalContent.classList.remove('scale-100', 'opacity-100');
        
        setTimeout(() => {
            modal.classList.add('hidden');
        }, 300);
    }
    
    // Update preview in real-time
    function updateInvoicePreview() {
        const prefixInput = document.getElementById('modal_invoice_prefix');
        const startingNumberInput = document.getElementById('modal_invoice_starting_number');
        const currentPreview = document.getElementById('current-preview');
        const nextPreview = document.getElementById('next-preview');
        
        const prefix = prefixInput.value.trim();
        const startingNumber = parseInt(startingNumberInput.value) || 1;
        
        if (prefix) {
            const formattedNumber = String(startingNumber).padStart(2, '0');
            currentPreview.textContent = `${prefix}${formattedNumber}`;
            nextPreview.textContent = `${prefix}${String(startingNumber + 1).padStart(2, '0')}`;
        } else {
            currentPreview.textContent = 'BILL' + Date.now().toString().slice(-9);
            nextPreview.textContent = 'Will be generated automatically';
        }
    }
    
    // Add event listeners for real-time preview
    document.addEventListener('DOMContentLoaded', function() {
        const prefixInput = document.getElementById('modal_invoice_prefix');
        const startingNumberInput = document.getElementById('modal_invoice_starting_number');
        
        if (prefixInput) {
            prefixInput.addEventListener('input', updateInvoicePreview);
        }
        if (startingNumberInput) {
            startingNumberInput.addEventListener('input', updateInvoicePreview);
        }
    });
    
    // Form submission
    document.getElementById('invoiceConfigForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        
        const formData = new FormData(this);
        const submitButton = e.target.querySelector('button[type="submit"]');
        const originalText = submitButton.innerHTML;
        
        // Show loading state
        submitButton.innerHTML = '<i data-feather="loader" class="w-4 h-4 inline mr-2 animate-spin"></i>Saving...';
        submitButton.disabled = true;
        feather.replace();
        
        try {
            const response = await fetch('/shopkeeper/update-invoice-config', {
                method: 'POST',
                body: formData,
                headers: {
                    'X-Requested-With': 'XMLHttpRequest'
                }
            });
            
            const result = await response.json();
            
            if (result.success) {
                // Show success message
                showFlashMessage('Invoice configuration updated successfully!', 'success');
                
                // Update the main page preview
                location.reload();
                
                // Close modal
                closeInvoiceModal();
            } else {
                showFlashMessage(result.message || 'Failed to update configuration', 'error');
            }
        } catch (error) {
            console.error('Error:', error);
            showFlashMessage('An error occurred while updating configuration', 'error');
        } finally {
            // Restore button
            submitButton.innerHTML = originalText;
            submitButton.disabled = false;
            feather.replace();
        }
    });
    
    // Close modal when clicking outside
    document.getElementById('invoiceModal').addEventListener('click', function(e) {
        if (e.target === this) {
            closeInvoiceModal();
        }
    });
    
    // Close modal on escape key
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape' && !document.getElementById('invoiceModal').classList.contains('hidden')) {
            closeInvoiceModal();
        }
    });
    
    // Template Modal Functions
    function openTemplateModal() {
        const modal = document.getElementById('templateModal');
        const modalContent = document.getElementById('templateModalContent');
        
        modal.classList.remove('hidden');
        
        // Animate modal in
        setTimeout(() => {
            modalContent.classList.remove('scale-95', 'opacity-0');
            modalContent.classList.add('scale-100', 'opacity-100');
        }, 10);
        
        // Setup template option listeners
        setupTemplateListeners();
        
        // Re-initialize feather icons
        feather.replace();
    }
    
    function closeTemplateModal() {
        const modal = document.getElementById('templateModal');
        const modalContent = document.getElementById('templateModalContent');
        
        // Animate modal out
        modalContent.classList.add('scale-95', 'opacity-0');
        modalContent.classList.remove('scale-100', 'opacity-100');
        
        setTimeout(() => {
            modal.classList.add('hidden');
        }, 300);
    }
    
    function setupTemplateListeners() {
        const templateOptions = document.querySelectorAll('.template-option');
        const radioButtons = document.querySelectorAll('input[name="template_choice"]');
        
        // Add click listeners to template option divs
        templateOptions.forEach(option => {
            option.addEventListener('click', function() {
                const templateValue = this.dataset.template;
                const radioButton = document.getElementById(templateValue);
                if (radioButton) {
                    radioButton.checked = true;
                    updateTemplatePreview(templateValue);
                    updateTemplateSelection();
                }
            });
        });
        
        // Add change listeners to radio buttons
        radioButtons.forEach(radio => {
            radio.addEventListener('change', function() {
                if (this.checked) {
                    updateTemplatePreview(this.value);
                    updateTemplateSelection();
                }
            });
        });
        
        // Update initial selection styling
        updateTemplateSelection();
    }
    
    function updateTemplateSelection() {
        const selectedTemplate = document.querySelector('input[name="template_choice"]:checked');
        const templateOptions = document.querySelectorAll('.template-option');
        
        templateOptions.forEach(option => {
            option.classList.remove('border-indigo-500', 'bg-indigo-50');
            option.classList.add('border-gray-300');
        });
        
        if (selectedTemplate) {
            const selectedOption = document.querySelector(`[data-template="${selectedTemplate.value}"]`);
            if (selectedOption) {
                selectedOption.classList.remove('border-gray-300');
                selectedOption.classList.add('border-indigo-500', 'bg-indigo-50');
            }
        }
    }
    
    function updateTemplatePreview(templateValue) {
        const previewImage = document.getElementById('templatePreviewImage');
        const previewTitle = document.getElementById('previewTitle');
        const previewDescription = document.getElementById('previewDescription');
        const previewLoading = document.getElementById('previewLoading');
        
        // Show loading state
        previewLoading.classList.remove('hidden');
        
        let imagePath, title, description;
        
        switch(templateValue) {
            case 'template1':
                imagePath = '/static/images/bill-templates/basic-bill-template.png';
                title = 'Basic Template';
                description = 'Simple and clean design';
                break;
            case 'template3':
                imagePath = '/static/images/bill-templates/modern-bill-template.png';
                title = 'Modern Template';
                description = 'Contemporary design with modern elements';
                break;
            default: // template2
                imagePath = '/static/images/bill-templates/professional-bill-template.png';
                title = 'Professional Template';
                description = 'Elegant design with advanced formatting';
                break;
        }
        
        // Update preview image
        setTimeout(() => {
            previewImage.src = imagePath;
            previewTitle.textContent = title;
            previewDescription.textContent = description;
            previewLoading.classList.add('hidden');
        }, 200);
    }
    
    async function saveTemplateConfig() {
        const selectedTemplate = document.querySelector('input[name="template_choice"]:checked');
        
        if (!selectedTemplate) {
            showFlashMessage('Please select a template', 'warning');
            return;
        }
        
        const submitButton = event.target;
        const originalText = submitButton.innerHTML;
        
        // Show loading state
        submitButton.innerHTML = '<i data-feather="loader" class="w-4 h-4 inline mr-2 animate-spin"></i>Saving...';
        submitButton.disabled = true;
        feather.replace();
        
        try {
            const formData = new FormData();
            formData.append('template_choice', selectedTemplate.value);
            
            const response = await fetch('/shopkeeper/update-template-config', {
                method: 'POST',
                body: formData,
                headers: {
                    'X-Requested-With': 'XMLHttpRequest'
                }
            });
            
            const result = await response.json();
            
            if (result.success) {
                showFlashMessage('Template updated successfully!', 'success');
                
                // Update the main page preview
                setTimeout(() => {
                    location.reload();
                }, 1000);
                
                // Close modal
                closeTemplateModal();
            } else {
                showFlashMessage(result.message || 'Failed to update template', 'error');
            }
        } catch (error) {
            console.error('Error:', error);
            showFlashMessage('An error occurred while updating template', 'error');
        } finally {
            // Restore button
            submitButton.innerHTML = originalText;
            submitButton.disabled = false;
            feather.replace();
        }
    }
    
    // Close template modal when clicking outside
    document.getElementById('templateModal').addEventListener('click', function(e) {
        if (e.target === this) {
            closeTemplateModal();
        }
    });
    
    // Close template modal on escape key
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape' && !document.getElementById('templateModal').classList.contains('hidden')) {
            closeTemplateModal();
        }
    });
</script>

<script>
    // Initialize Feather icons
    feather.replace();
    
    // Add smooth scrolling for sections
    document.addEventListener('DOMContentLoaded', function() {
        // Initialize feather icons after DOM is loaded
        feather.replace();
        
        // Check URL parameters for modal opening
        const urlParams = new URLSearchParams(window.location.search);
        const modalParam = urlParams.get('modal');
        
        if (modalParam === 'template') {
            // Wait a bit for DOM to be ready then open template modal
            setTimeout(() => {
                openTemplateModal();
            }, 100);
        } else if (modalParam === 'invoice') {
            // Wait a bit for DOM to be ready then open invoice modal
            setTimeout(() => {
                openInvoiceModal();
            }, 100);
        }
        
        // Add hover effects to info cards
        const infoCards = document.querySelectorAll('.info-card');
        infoCards.forEach(card => {
            card.addEventListener('mouseenter', function() {
                this.style.transform = 'translateX(5px)';
            });
            
            card.addEventListener('mouseleave', function() {
                this.style.transform = 'translateX(0)';
            });
        });
    });
</script>

{% endblock %}
