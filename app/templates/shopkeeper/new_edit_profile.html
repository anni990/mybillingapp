{% extends 'shopkeeper/s_base.html' %}
{% block title %}Edit Profile | MyBillingApp{% endblock %}
{% block shop_name %} {{ shop_name }} {% endblock %}
{% block content %}
<link rel="stylesheet" href="https://unpkg.com/@fortawesome/fontawesome-free/css/all.min.css">
<script src="https://unpkg.com/feather-icons"></script>

<style>
    @keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(30px);
        }

        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    @keyframes slideInLeft {
        from {
            opacity: 0;
            transform: translateX(-50px);
        }

        to {
            opacity: 1;
            transform: translateX(0);
        }
    }

    @keyframes fadeIn {
        from {
            opacity: 0;
        }

        to {
            opacity: 1;
        }
    }

    .fade-in-up {
        animation: fadeInUp 0.6s ease-out;
    }

    .slide-in-left {
        animation: slideInLeft 0.5s ease-out;
    }

    .fade-in {
        animation: fadeIn 0.4s ease-out;
    }

    .gradient-bg {
        background: linear-gradient(135deg, #eeeeee 0%, #eaecee 100%);
    }

    .edit-form-container {
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .form-section {
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .form-section:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
    }

    .form-input {
        transition: all 0.3s ease;
    }

    .form-input:focus {
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(237, 106, 62, 0.15);
    }
</style>

<div class="p-4 md:p-8 lg:-mt-8">
    <!-- Edit Mode Header -->
    <div class="fade-in gradient-bg rounded-2xl p-6 mb-8 border border-gray-200">
        <div class="flex items-center justify-between">
            <div class="flex items-center space-x-4">
                <div class="p-3 bg-blue-100  rounded-xl shadow-lg">
                    <i data-feather="edit-3" class="w-6 h-6 text-blue-600"></i>
                </div>
                <div>
                    <h1 class="text-2xl md:text-3xl font-bold text-gray-800">Edit Profile</h1>
                    <p class="text-gray-600 hidden">Update your business and personal information</p>
                </div>
            </div>
            <a href="{{ url_for('shopkeeper.profile') }}"
                class="flex items-center justify-center space-x-2 px-2 py-2 bg-blue-100 text-blue-700 rounded-lg hover:bg-gray-200 transition-colors duration-200 shadow-sm">

                <!-- Icon always visible -->
                <i data-feather="eye" class="w-4 h-4"></i>

                <!-- Text visible only on medium and larger screens -->
                <span class="hidden sm:inline">View Profile</span>
            </a>

        </div>
    </div>

    <div class="edit-form-container fade-in">
        <form method="POST" action="{{ url_for('shopkeeper.profile_edit') }}" enctype="multipart/form-data"
            class="space-y-8">

            <!-- Personal Information Section -->
            <div class="form-section bg-white rounded-2xl shadow-lg p-8 border border-pink-200">
                <div class="flex items-center mb-6">
                    <div class="p-3 bg-pink-100 rounded-xl shadow-lg">
                        <i data-feather="user" class="w-6 h-6 text-pink-600"></i>
                    </div>
                    <h2 class="text-2xl font-bold text-gray-800 ml-4">Personal Information</h2>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label for="owner_name" class="block text-sm font-semibold text-gray-700 mb-2">
                            <i data-feather="user" class="w-4 h-4 inline mr-2 text-pink-500"></i>
                            Owner Name
                        </label>
                        <input type="text" id="owner_name" name="owner_name" value="{{ shopkeeper.owner_name or '' }}"
                            placeholder="Enter your full name"
                            class="form-input w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-pink-500 focus:border-transparent transition duration-200 text-gray-700">
                    </div>

                    <div>
                        <label for="pan_number" class="block text-sm font-semibold text-gray-700 mb-2">
                            <i data-feather="credit-card" class="w-4 h-4 inline mr-2 text-pink-500"></i>
                            PAN Number
                        </label>
                        <input type="text" id="pan_number" name="pan_number" value="{{ shopkeeper.pan_number or '' }}"
                            placeholder="e.g., ABCDE1234F" maxlength="10"
                            class="form-input w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-pink-500 focus:border-transparent transition duration-200 text-gray-700">
                    </div>

                    <div class="md:col-span-2">
                        <label for="owner_address" class="block text-sm font-semibold text-gray-700 mb-2">
                            <i data-feather="home" class="w-4 h-4 inline mr-2 text-pink-500"></i>
                            Owner Address
                        </label>
                        <textarea id="owner_address" name="owner_address" rows="3"
                            placeholder="Enter your residential address"
                            class="form-input w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-pink-500 focus:border-transparent transition duration-200 text-gray-700">{{ shopkeeper.owner_address or '' }}</textarea>
                    </div>
                </div>
            </div>

            <!-- Business Information Section -->
            <div class="form-section bg-white rounded-2xl shadow-lg p-8 border border-cyan-200">
                <div class="flex items-center mb-6">
                    <div class="p-3 bg-cyan-100 rounded-xl shadow-lg">
                        <i data-feather="briefcase" class="w-6 h-6 text-cyan-600"></i>
                    </div>
                    <h2 class="text-2xl font-bold text-gray-800 ml-4">Business Information</h2>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label for="shop_name" class="block text-sm font-semibold text-gray-700 mb-2">
                            <i data-feather="store" class="w-4 h-4 inline mr-2 text-cyan-500"></i>
                            Shop Name <span class="text-red-500">*</span>
                        </label>
                        <input type="text" id="shop_name" name="shop_name" value="{{ shopkeeper.shop_name or '' }}"
                            placeholder="Enter your business name" required
                            class="form-input w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-cyan-500 focus:border-transparent transition duration-200 text-gray-700">
                    </div>

                    <div>
                        <label for="business_type" class="block text-sm font-semibold text-gray-700 mb-2">
                            <i data-feather="tag" class="w-4 h-4 inline mr-2 text-cyan-500"></i>
                            Business Type
                        </label>
                        <input type="text" id="business_type" name="business_type"
                            value="{{ shopkeeper.business_type or shopkeeper.domain or '' }}"
                            placeholder="e.g., Retail, Wholesale, Services"
                            class="form-input w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-cyan-500 focus:border-transparent transition duration-200 text-gray-700">
                    </div>

                    <div>
                        <label for="established_year" class="block text-sm font-semibold text-gray-700 mb-2">
                            <i data-feather="calendar" class="w-4 h-4 inline mr-2 text-cyan-500"></i>
                            Established Year
                        </label>
                        <input type="number" id="established_year" name="established_year"
                            value="{{ shopkeeper.established_year or '' }}" placeholder="e.g., 2020" min="1900"
                            max="2024"
                            class="form-input w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-cyan-500 focus:border-transparent transition duration-200 text-gray-700">
                    </div>

                    <div>
                        <label for="gst_number" class="block text-sm font-semibold text-gray-700 mb-2">
                            <i data-feather="award" class="w-4 h-4 inline mr-2 text-cyan-500"></i>
                            GST Number
                        </label>
                        <input type="text" id="gst_number" name="gst_number" value="{{ shopkeeper.gst_number or '' }}"
                            placeholder="e.g., 22AAAAA0000A1Z5" maxlength="15"
                            class="form-input w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-cyan-500 focus:border-transparent transition duration-200 text-gray-700">
                    </div>

                    <div>
                        <label for="contact_number" class="block text-sm font-semibold text-gray-700 mb-2">
                            <i data-feather="phone" class="w-4 h-4 inline mr-2 text-cyan-500"></i>
                            Contact Number
                        </label>
                        <input type="tel" id="contact_number" name="contact_number"
                            value="{{ shopkeeper.contact_number or '' }}" placeholder="e.g., +91 98765 43210"
                            class="form-input w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-cyan-500 focus:border-transparent transition duration-200 text-gray-700">
                    </div>

                    <div class="md:col-span-2">
                        <label for="business_address" class="block text-sm font-semibold text-gray-700 mb-2">
                            <i data-feather="map-pin" class="w-4 h-4 inline mr-2 text-cyan-500"></i>
                            Business Address
                        </label>
                        <textarea id="business_address" name="business_address" rows="3"
                            placeholder="Enter your business address"
                            class="form-input w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-cyan-500 focus:border-transparent transition duration-200 text-gray-700">{{ shopkeeper.business_address or shopkeeper.address or '' }}</textarea>
                    </div>
                </div>
            </div>

            <!-- Location Information Section -->
            <div class="form-section bg-white rounded-2xl shadow-lg p-8 border border-green-200">
                <div class="flex items-center mb-6">
                    <div class="p-3 bg-green-100 rounded-xl shadow-lg">
                        <i data-feather="map-pin" class="w-6 h-6 text-green-600"></i>
                    </div>
                    <h2 class="text-2xl font-bold text-gray-800 ml-4">Location Details</h2>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div>
                        <label for="city" class="block text-sm font-semibold text-gray-700 mb-2">
                            <i data-feather="map" class="w-4 h-4 inline mr-2 text-green-500"></i>
                            City
                        </label>
                        <input type="text" id="city" name="city" value="{{ shopkeeper.city or '' }}"
                            placeholder="Enter your city"
                            class="form-input w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-transparent transition duration-200 text-gray-700">
                    </div>

                    <div>
                        <label for="state" class="block text-sm font-semibold text-gray-700 mb-2">
                            <i data-feather="globe" class="w-4 h-4 inline mr-2 text-green-500"></i>
                            State
                        </label>
                        <input type="text" id="state" name="state" value="{{ shopkeeper.state or '' }}"
                            placeholder="Enter your state"
                            class="form-input w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-transparent transition duration-200 text-gray-700">
                    </div>

                    <div>
                        <label for="pincode" class="block text-sm font-semibold text-gray-700 mb-2">
                            <i data-feather="hash" class="w-4 h-4 inline mr-2 text-green-500"></i>
                            Pincode
                        </label>
                        <input type="text" id="pincode" name="pincode" value="{{ shopkeeper.pincode or '' }}"
                            placeholder="e.g., 400001" maxlength="6"
                            class="form-input w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-transparent transition duration-200 text-gray-700">
                    </div>
                </div>
            </div>

            <!-- Banking Information Section -->
            <div class="form-section bg-white rounded-2xl shadow-lg p-8 border border-purple-200">
                <div class="flex items-center mb-6">
                    <div class="p-3 bg-purple-100 rounded-xl shadow-lg">
                        <i data-feather="credit-card" class="w-6 h-6 text-purple-600"></i>
                    </div>
                    <h2 class="text-2xl font-bold text-gray-800 ml-4">Banking Information</h2>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label for="bank_name" class="block text-sm font-semibold text-gray-700 mb-2">
                            <i data-feather="home" class="w-4 h-4 inline mr-2 text-purple-500"></i>
                            Bank Name
                        </label>
                        <input type="text" id="bank_name" name="bank_name" value="{{ shopkeeper.bank_name or '' }}"
                            placeholder="e.g., State Bank of India"
                            class="form-input w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent transition duration-200 text-gray-700">
                    </div>

                    <div>
                        <label for="account_number" class="block text-sm font-semibold text-gray-700 mb-2">
                            <i data-feather="hash" class="w-4 h-4 inline mr-2 text-purple-500"></i>
                            Account Number
                        </label>
                        <input type="text" id="account_number" name="account_number"
                            value="{{ shopkeeper.account_number or '' }}" placeholder="Enter your account number"
                            class="form-input w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent transition duration-200 text-gray-700">
                    </div>

                    <div>
                        <label for="ifsc_code" class="block text-sm font-semibold text-gray-700 mb-2">
                            <i data-feather="code" class="w-4 h-4 inline mr-2 text-purple-500"></i>
                            IFSC Code
                        </label>
                        <input type="text" id="ifsc_code" name="ifsc_code" value="{{ shopkeeper.ifsc_code or '' }}"
                            placeholder="e.g., SBIN0000123" maxlength="11"
                            class="form-input w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent transition duration-200 text-gray-700">
                    </div>

                    <div>
                        <label for="upi_id" class="block text-sm font-semibold text-gray-700 mb-2">
                            <i data-feather="smartphone" class="w-4 h-4 inline mr-2 text-purple-500"></i>
                            UPI ID
                        </label>
                        <input type="text" id="upi_id" name="upi_id" value="{{ shopkeeper.upi_id or '' }}"
                            placeholder="e.g., yourname@paytm"
                            class="form-input w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent transition duration-200 text-gray-700">
                    </div>
                </div>
            </div>

            <!-- Document Upload Section -->
            <div class="form-section bg-white rounded-2xl shadow-lg p-8 border border-gray-200">
                <div class="flex items-center mb-6">
                    <div class="p-3 bg-gray-100 rounded-xl shadow-lg">
                        <i data-feather="folder" class="w-6 h-6 text-gray-600"></i>
                    </div>
                    <h2 class="text-2xl font-bold text-gray-800 ml-4">Business Documents</h2>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <!-- GST Certificate -->
                    <div
                        class="document-upload-card p-6 bg-gray-50 rounded-xl border border-gray-200 hover:border-blue-400 transition-colors">
                        <div class="flex items-center mb-4">
                            <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center mr-3">
                                <i data-feather="award" class="w-5 h-5 text-blue-600"></i>
                            </div>
                            <div>
                                <h3 class="font-semibold text-gray-800">GST Certificate</h3>
                                <p class="text-xs text-gray-600">Tax registration document</p>
                            </div>
                        </div>
                        {% if shopkeeper.gst_doc_path %}
                        <div class="mb-3">
                            <span class="bg-green-100 text-green-800 text-xs px-2 py-1 rounded-full">Currently
                                Uploaded</span>
                            <a href="{{ url_for('static', filename=shopkeeper.gst_doc_path) }}" target="_blank"
                                class="text-blue-600 hover:text-blue-800 text-xs ml-2">
                                <i data-feather="external-link" class="w-3 h-3 inline mr-1"></i>View
                            </a>
                        </div>
                        {% endif %}
                        <input type="file" name="gst_doc" accept=".pdf,.jpg,.jpeg,.png"
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm">
                        <p class="text-xs text-gray-500 mt-1">PDF, JPG, PNG (Max 2MB)</p>
                        {% if shopkeeper.gst_doc_path %}
                        <button type="button" onclick="deleteDocument('gst')"
                            class="mt-2 text-red-600 hover:text-red-800 text-xs">
                            <i data-feather="trash-2" class="w-3 h-3 inline mr-1"></i>Delete Current
                        </button>
                        {% endif %}
                    </div>

                    <!-- PAN Card -->
                    <div
                        class="document-upload-card p-6 bg-gray-50 rounded-xl border border-gray-200 hover:border-green-400 transition-colors">
                        <div class="flex items-center mb-4">
                            <div class="w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center mr-3">
                                <i data-feather="credit-card" class="w-5 h-5 text-green-600"></i>
                            </div>
                            <div>
                                <h3 class="font-semibold text-gray-800">PAN Card</h3>
                                <p class="text-xs text-gray-600">Tax identification</p>
                            </div>
                        </div>
                        {% if shopkeeper.pan_doc_path %}
                        <div class="mb-3">
                            <span class="bg-green-100 text-green-800 text-xs px-2 py-1 rounded-full">Currently
                                Uploaded</span>
                            <a href="{{ url_for('static', filename=shopkeeper.pan_doc_path) }}" target="_blank"
                                class="text-blue-600 hover:text-blue-800 text-xs ml-2">
                                <i data-feather="external-link" class="w-3 h-3 inline mr-1"></i>View
                            </a>
                        </div>
                        {% endif %}
                        <input type="file" name="pan_doc" accept=".pdf,.jpg,.jpeg,.png"
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent text-sm">
                        <p class="text-xs text-gray-500 mt-1">PDF, JPG, PNG (Max 2MB)</p>
                        {% if shopkeeper.pan_doc_path %}
                        <button type="button" onclick="deleteDocument('pan')"
                            class="mt-2 text-red-600 hover:text-red-800 text-xs">
                            <i data-feather="trash-2" class="w-3 h-3 inline mr-1"></i>Delete Current
                        </button>
                        {% endif %}
                    </div>

                    <!-- Address Proof -->
                    <div
                        class="document-upload-card p-6 bg-gray-50 rounded-xl border border-gray-200 hover:border-purple-400 transition-colors">
                        <div class="flex items-center mb-4">
                            <div class="w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center mr-3">
                                <i data-feather="map-pin" class="w-5 h-5 text-purple-600"></i>
                            </div>
                            <div>
                                <h3 class="font-semibold text-gray-800">Address Proof</h3>
                                <p class="text-xs text-gray-600">Business address verification</p>
                            </div>
                        </div>
                        {% if shopkeeper.address_proof_path %}
                        <div class="mb-3">
                            <span class="bg-green-100 text-green-800 text-xs px-2 py-1 rounded-full">Currently
                                Uploaded</span>
                            <a href="{{ url_for('static', filename=shopkeeper.address_proof_path) }}" target="_blank"
                                class="text-blue-600 hover:text-blue-800 text-xs ml-2">
                                <i data-feather="external-link" class="w-3 h-3 inline mr-1"></i>View
                            </a>
                        </div>
                        {% endif %}
                        <input type="file" name="address_proof" accept=".pdf,.jpg,.jpeg,.png"
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-sm">
                        <p class="text-xs text-gray-500 mt-1">PDF, JPG, PNG (Max 2MB)</p>
                        {% if shopkeeper.address_proof_path %}
                        <button type="button" onclick="deleteDocument('address_proof')"
                            class="mt-2 text-red-600 hover:text-red-800 text-xs">
                            <i data-feather="trash-2" class="w-3 h-3 inline mr-1"></i>Delete Current
                        </button>
                        {% endif %}
                    </div>

                    <!-- Aadhaar/DL -->
                    <div
                        class="document-upload-card p-6 bg-gray-50 rounded-xl border border-gray-200 hover:border-yellow-400 transition-colors">
                        <div class="flex items-center mb-4">
                            <div class="w-10 h-10 bg-yellow-100 rounded-lg flex items-center justify-center mr-3">
                                <i data-feather="user-check" class="w-5 h-5 text-yellow-600"></i>
                            </div>
                            <div>
                                <h3 class="font-semibold text-gray-800">Aadhaar/DL</h3>
                                <p class="text-xs text-gray-600">Identity proof document</p>
                            </div>
                        </div>
                        {% if shopkeeper.aadhaar_dl_path %}
                        <div class="mb-3">
                            <span class="bg-green-100 text-green-800 text-xs px-2 py-1 rounded-full">Currently
                                Uploaded</span>
                            <a href="{{ url_for('static', filename=shopkeeper.aadhaar_dl_path) }}" target="_blank"
                                class="text-blue-600 hover:text-blue-800 text-xs ml-2">
                                <i data-feather="external-link" class="w-3 h-3 inline mr-1"></i>View
                            </a>
                        </div>
                        {% endif %}
                        <input type="file" name="aadhaar_dl" accept=".pdf,.jpg,.jpeg,.png"
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent text-sm">
                        <p class="text-xs text-gray-500 mt-1">PDF, JPG, PNG (Max 2MB)</p>
                        {% if shopkeeper.aadhaar_dl_path %}
                        <button type="button" onclick="deleteDocument('aadhaar_dl')"
                            class="mt-2 text-red-600 hover:text-red-800 text-xs">
                            <i data-feather="trash-2" class="w-3 h-3 inline mr-1"></i>Delete Current
                        </button>
                        {% endif %}
                    </div>

                    <!-- Selfie Photo -->
                    <div
                        class="document-upload-card p-6 bg-gray-50 rounded-xl border border-gray-200 hover:border-pink-400 transition-colors">
                        <div class="flex items-center mb-4">
                            <div class="w-10 h-10 bg-pink-100 rounded-lg flex items-center justify-center mr-3">
                                <i data-feather="camera" class="w-5 h-5 text-pink-600"></i>
                            </div>
                            <div>
                                <h3 class="font-semibold text-gray-800">Owner Selfie</h3>
                                <p class="text-xs text-gray-600">Photo verification</p>
                            </div>
                        </div>
                        {% if shopkeeper.selfie_path %}
                        <div class="mb-3">
                            <span class="bg-green-100 text-green-800 text-xs px-2 py-1 rounded-full">Currently
                                Uploaded</span>
                            <a href="{{ url_for('static', filename=shopkeeper.selfie_path) }}" target="_blank"
                                class="text-blue-600 hover:text-blue-800 text-xs ml-2">
                                <i data-feather="external-link" class="w-3 h-3 inline mr-1"></i>View
                            </a>
                        </div>
                        {% endif %}
                        <input type="file" name="selfie" accept=".jpg,.jpeg,.png"
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent text-sm">
                        <p class="text-xs text-gray-500 mt-1">JPG, PNG only (Max 2MB)</p>
                        {% if shopkeeper.selfie_path %}
                        <button type="button" onclick="deleteDocument('selfie')"
                            class="mt-2 text-red-600 hover:text-red-800 text-xs">
                            <i data-feather="trash-2" class="w-3 h-3 inline mr-1"></i>Delete Current
                        </button>
                        {% endif %}
                    </div>

                    <!-- Gumasta License -->
                    <div
                        class="document-upload-card p-6 bg-gray-50 rounded-xl border border-gray-200 hover:border-red-400 transition-colors">
                        <div class="flex items-center mb-4">
                            <div class="w-10 h-10 bg-red-100 rounded-lg flex items-center justify-center mr-3">
                                <i data-feather="file-text" class="w-5 h-5 text-red-600"></i>
                            </div>
                            <div>
                                <h3 class="font-semibold text-gray-800">Gumasta License</h3>
                                <p class="text-xs text-gray-600">Business license document</p>
                            </div>
                        </div>
                        {% if shopkeeper.gumasta_path %}
                        <div class="mb-3">
                            <span class="bg-green-100 text-green-800 text-xs px-2 py-1 rounded-full">Currently
                                Uploaded</span>
                            <a href="{{ url_for('static', filename=shopkeeper.gumasta_path) }}" target="_blank"
                                class="text-blue-600 hover:text-blue-800 text-xs ml-2">
                                <i data-feather="external-link" class="w-3 h-3 inline mr-1"></i>View
                            </a>
                        </div>
                        {% endif %}
                        <input type="file" name="gumasta" accept=".pdf,.jpg,.jpeg,.png"
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent text-sm">
                        <p class="text-xs text-gray-500 mt-1">PDF, JPG, PNG (Max 2MB)</p>
                        {% if shopkeeper.gumasta_path %}
                        <button type="button" onclick="deleteDocument('gumasta')"
                            class="mt-2 text-red-600 hover:text-red-800 text-xs">
                            <i data-feather="trash-2" class="w-3 h-3 inline mr-1"></i>Delete Current
                        </button>
                        {% endif %}
                    </div>

                    <!-- Udyam Registration -->
                    <div
                        class="document-upload-card p-6 bg-gray-50 rounded-xl border border-gray-200 hover:border-orange-400 transition-colors">
                        <div class="flex items-center mb-4">
                            <div class="w-10 h-10 bg-orange-100 rounded-lg flex items-center justify-center mr-3">
                                <i data-feather="briefcase" class="w-5 h-5 text-orange-600"></i>
                            </div>
                            <div>
                                <h3 class="font-semibold text-gray-800">Udyam Registration</h3>
                                <p class="text-xs text-gray-600">MSME certificate</p>
                            </div>
                        </div>
                        {% if shopkeeper.udyam_path %}
                        <div class="mb-3">
                            <span class="bg-green-100 text-green-800 text-xs px-2 py-1 rounded-full">Currently
                                Uploaded</span>
                            <a href="{{ url_for('static', filename=shopkeeper.udyam_path) }}" target="_blank"
                                class="text-blue-600 hover:text-blue-800 text-xs ml-2">
                                <i data-feather="external-link" class="w-3 h-3 inline mr-1"></i>View
                            </a>
                        </div>
                        {% endif %}
                        <input type="file" name="udyam" accept=".pdf,.jpg,.jpeg,.png"
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent text-sm">
                        <p class="text-xs text-gray-500 mt-1">PDF, JPG, PNG (Max 2MB)</p>
                        {% if shopkeeper.udyam_path %}
                        <button type="button" onclick="deleteDocument('udyam')"
                            class="mt-2 text-red-600 hover:text-red-800 text-xs">
                            <i data-feather="trash-2" class="w-3 h-3 inline mr-1"></i>Delete Current
                        </button>
                        {% endif %}
                    </div>

                    <!-- Bank Statement -->
                    <div
                        class="document-upload-card p-6 bg-gray-50 rounded-xl border border-gray-200 hover:border-indigo-400 transition-colors">
                        <div class="flex items-center mb-4">
                            <div class="w-10 h-10 bg-indigo-100 rounded-lg flex items-center justify-center mr-3">
                                <i data-feather="trending-up" class="w-5 h-5 text-indigo-600"></i>
                            </div>
                            <div>
                                <h3 class="font-semibold text-gray-800">Bank Statement</h3>
                                <p class="text-xs text-gray-600">Financial proof document</p>
                            </div>
                        </div>
                        {% if shopkeeper.bank_statement_path %}
                        <div class="mb-3">
                            <span class="bg-green-100 text-green-800 text-xs px-2 py-1 rounded-full">Currently
                                Uploaded</span>
                            <a href="{{ url_for('static', filename=shopkeeper.bank_statement_path) }}" target="_blank"
                                class="text-blue-600 hover:text-blue-800 text-xs ml-2">
                                <i data-feather="external-link" class="w-3 h-3 inline mr-1"></i>View
                            </a>
                        </div>
                        {% endif %}
                        <input type="file" name="bank_statement" accept=".pdf,.jpg,.jpeg,.png"
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent text-sm">
                        <p class="text-xs text-gray-500 mt-1">PDF, JPG, PNG (Max 2MB)</p>
                        {% if shopkeeper.bank_statement_path %}
                        <button type="button" onclick="deleteDocument('bank_statement')"
                            class="mt-2 text-red-600 hover:text-red-800 text-xs">
                            <i data-feather="trash-2" class="w-3 h-3 inline mr-1"></i>Delete Current
                        </button>
                        {% endif %}
                    </div>

                    <!-- Business Logo -->
                    <div
                        class="document-upload-card p-6 bg-gray-50 rounded-xl border border-gray-200 hover:border-cyan-400 transition-colors">
                        <div class="flex items-center mb-4">
                            <div class="w-10 h-10 bg-cyan-100 rounded-lg flex items-center justify-center mr-3">
                                <i data-feather="image" class="w-5 h-5 text-cyan-600"></i>
                            </div>
                            <div>
                                <h3 class="font-semibold text-gray-800">Business Logo</h3>
                                <p class="text-xs text-gray-600">Brand identity image</p>
                            </div>
                        </div>
                        {% if shopkeeper.logo_path %}
                        <div class="mb-3">
                            <span class="bg-green-100 text-green-800 text-xs px-2 py-1 rounded-full">Currently
                                Uploaded</span>
                            <a href="{{ url_for('static', filename=shopkeeper.logo_path) }}" target="_blank"
                                class="text-blue-600 hover:text-blue-800 text-xs ml-2">
                                <i data-feather="external-link" class="w-3 h-3 inline mr-1"></i>View
                            </a>
                        </div>
                        {% endif %}
                        <input type="file" name="logo" accept=".jpg,.jpeg,.png,.svg"
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent text-sm">
                        <p class="text-xs text-gray-500 mt-1">JPG, PNG, SVG (Max 2MB)</p>
                        {% if shopkeeper.logo_path %}
                        <button type="button" onclick="deleteDocument('logo')"
                            class="mt-2 text-red-600 hover:text-red-800 text-xs">
                            <i data-feather="trash-2" class="w-3 h-3 inline mr-1"></i>Delete Current
                        </button>
                        {% endif %}
                    </div>
                </div>

                <div class="mt-6 p-4 bg-blue-50 border border-blue-200 rounded-lg">
                    <div class="flex items-start">
                        <div class="flex-shrink-0">
                            <i data-feather="info" class="w-5 h-5 text-blue-600 mt-0.5"></i>
                        </div>
                        <div class="ml-3">
                            <h4 class="text-sm font-semibold text-blue-800">Document Upload Guidelines</h4>
                            <div class="mt-2 text-sm text-blue-700">
                                <ul class="list-disc list-inside space-y-1">
                                    <li>Maximum file size: 2MB per document</li>
                                    <li>Supported formats: PDF, JPG, JPEG, PNG (SVG for logo only)</li>
                                    <li>Ensure documents are clear and readable</li>
                                    <li>All documents help verify your business for better CA connections</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Bill Template Settings Section -->
            <div class="form-section bg-white rounded-2xl shadow-lg p-8 border border-indigo-200">
                <div class="flex items-center mb-6">
                    <div class="p-3 bg-indigo-100 rounded-xl shadow-lg">
                        <i data-feather="file-text" class="w-6 h-6 text-indigo-600"></i>
                    </div>
                    <h2 class="text-2xl font-bold text-gray-800 ml-4">Bill Template Settings</h2>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label for="template_choice" class="block text-sm font-semibold text-gray-700 mb-2">
                            <i data-feather="layout" class="w-4 h-4 inline mr-2 text-indigo-500"></i>
                            Bill Template
                        </label>
                        <select id="template_choice" name="template_choice"
                            class="form-input w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition duration-200 text-gray-700">
                            <option value="template1" {{ 'selected' if shopkeeper.template_choice=='template1' else ''
                                }}>Template 1 - Basic Format</option>
                            <option value="template2" {{ 'selected' if shopkeeper.template_choice=='template2' or not
                                shopkeeper.template_choice else '' }}>Template 2 - Professional Format</option>
                            <option value="template3" {{ 'selected' if shopkeeper.template_choice=='template3' else ''
                                }}>Template 3 - Modern Format</option>
                        </select>
                    </div>

                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">
                            <i data-feather="eye" class="w-4 h-4 inline mr-2 text-indigo-500"></i>
                            Template Preview
                        </label>
                        <div class="form-input bg-gray-50 px-4 py-3 border-2 border-gray-300 rounded-xl text-gray-600">
                            <span id="template-preview">Professional Format</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Invoice Numbering Settings Section -->
            <div class="form-section bg-white rounded-2xl shadow-lg p-8 border border-emerald-200">
                <div class="flex items-center mb-6">
                    <div class="p-3 bg-emerald-100 rounded-xl shadow-lg">
                        <i data-feather="hash" class="w-6 h-6 text-emerald-600"></i>
                    </div>
                    <h2 class="text-2xl font-bold text-gray-800 ml-4">Invoice Numbering Settings</h2>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label for="invoice_prefix" class="block text-sm font-semibold text-gray-700 mb-2">
                            <i data-feather="tag" class="w-4 h-4 inline mr-2 text-emerald-500"></i>
                            Invoice Prefix
                        </label>
                        <input type="text" id="invoice_prefix" name="invoice_prefix"
                            value="{{ shopkeeper.invoice_prefix or '' }}"
                            placeholder="e.g., INV, BILL (leave empty for timestamp)" maxlength="10"
                            class="form-input w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition duration-200 text-gray-700">
                        <p class="text-xs text-gray-500 mt-1">Leave empty to use timestamp-based numbering
                            (BILL123456789)</p>
                    </div>

                    <div>
                        <label for="invoice_starting_number" class="block text-sm font-semibold text-gray-700 mb-2">
                            <i data-feather="play" class="w-4 h-4 inline mr-2 text-emerald-500"></i>
                            Starting Number
                        </label>
                        <input type="number" id="invoice_starting_number" name="invoice_starting_number"
                            value="{{ shopkeeper.invoice_starting_number or 1 }}" placeholder="1" min="1"
                            class="form-input w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition duration-200 text-gray-700">
                        <p class="text-xs text-gray-500 mt-1">Reset numbering to start from this number</p>
                    </div>

                    <div class="md:col-span-2">
                        <div class="bg-emerald-50 border border-emerald-200 rounded-xl p-4">
                            <div class="flex items-start">
                                <div class="flex-shrink-0">
                                    <i data-feather="info" class="w-5 h-5 text-emerald-600 mt-0.5"></i>
                                </div>
                                <div class="ml-3">
                                    <h4 class="text-sm font-semibold text-emerald-800">Invoice Numbering Preview</h4>
                                    <div class="mt-2 text-sm text-emerald-700">
                                        <p><strong>Current System:</strong>
                                            <span id="current-preview">
                                                {% if shopkeeper.invoice_prefix and shopkeeper.invoice_prefix.strip() %}
                                                Custom: {{ shopkeeper.invoice_prefix }}{{
                                                '%02d'|format(shopkeeper.current_invoice_number)}}
                                                {% else %}
                                                Timestamp-based (BILL123456789)
                                                {% endif %}
                                            </span>
                                        </p>
                                        <p><strong>Next Invoice:</strong>
                                            <span id="next-preview">
                                                {% if shopkeeper.invoice_prefix and shopkeeper.invoice_prefix.strip() %}
                                                {{ preview_next_invoice_number(shopkeeper) }}
                                                {% else %}
                                                Will be generated automatically
                                                {% endif %}
                                            </span>
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Form Actions -->
            <div class="form-section bg-white rounded-2xl shadow-lg p-6 border border-gray-200">
                <div class="flex flex-col md:flex-row gap-4 md:justify-end">
                    <a href="{{ url_for('shopkeeper.profile') }}"
                        class="flex items-center justify-center px-6 py-3 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-xl transition duration-300 font-medium border border-gray-300">
                        <i data-feather="x" class="w-4 h-4 mr-2"></i>
                        Cancel
                    </a>
                    <button type="submit"
                        class="flex items-center justify-center px-8 py-3 bg-orange-200 hover:bg-orange-300 text-orange-600 rounded-xl transition duration-300 font-semibold shadow-lg hover:shadow-xl">
                        <i data-feather="save" class="w-4 h-4 mr-2"></i>
                        Save Changes
                    </button>
                </div>
            </div>
        </form>
    </div>
</div>

<script>
    // Initialize Feather icons
    feather.replace();

    // Add form validation and dynamic preview
    document.addEventListener('DOMContentLoaded', function () {
        // Initialize feather icons after DOM is loaded
        feather.replace();

        // Template selection preview
        const templateSelect = document.getElementById('template_choice');
        const templatePreview = document.getElementById('template-preview');

        function updateTemplatePreview() {
            const selected = templateSelect.value;
            switch (selected) {
                case 'template1':
                    templatePreview.textContent = 'Basic Format - Simple layout with essential details';
                    break;
                case 'template2':
                    templatePreview.textContent = 'Professional Format - Enhanced design with business branding';
                    break;
                case 'template3':
                    templatePreview.textContent = 'Modern Format - Contemporary design with advanced features';
                    break;
                default:
                    templatePreview.textContent = 'Professional Format';
            }
        }

        templateSelect.addEventListener('change', updateTemplatePreview);
        updateTemplatePreview(); // Initial call

        // Invoice numbering preview
        const prefixInput = document.getElementById('invoice_prefix');
        const startingNumberInput = document.getElementById('invoice_starting_number');
        const currentPreview = document.getElementById('current-preview');
        const nextPreview = document.getElementById('next-preview');

        function updateInvoicePreview() {
            const prefix = prefixInput.value.trim();
            const startingNumber = parseInt(startingNumberInput.value) || 1;

            if (prefix) {
                const formattedNumber = String(startingNumber).padStart(2, '0');
                currentPreview.textContent = `Custom: ${prefix}${formattedNumber}`;
                nextPreview.textContent = `${prefix}${String(startingNumber + 1).padStart(2, '0')}`;
            } else {
                currentPreview.textContent = 'Timestamp-based (BILL123456789)';
                nextPreview.textContent = 'Will be generated automatically';
            }
        }

        prefixInput.addEventListener('input', updateInvoicePreview);
        startingNumberInput.addEventListener('input', updateInvoicePreview);

        // Form validation
        const form = document.querySelector('form');
        form.addEventListener('submit', function (e) {
            const shopName = document.getElementById('shop_name').value.trim();

            if (!shopName) {
                e.preventDefault();
                alert('Shop name is required!');
                document.getElementById('shop_name').focus();
                return false;
            }

            // PAN validation
            const panNumber = document.getElementById('pan_number').value.trim();
            if (panNumber) {
                const panPattern = /^[A-Z]{5}[0-9]{4}[A-Z]{1}$/;
                if (!panPattern.test(panNumber)) {
                    e.preventDefault();
                    alert('Please enter a valid PAN number (e.g., ABCDE1234F)');
                    document.getElementById('pan_number').focus();
                    return false;
                }
            }

            // GST validation
            const gstNumber = document.getElementById('gst_number').value.trim();
            if (gstNumber) {
                const gstPattern = /^[0-9]{2}[A-Z]{5}[0-9]{4}[A-Z]{1}[1-9A-Z]{1}[Z]{1}[0-9A-Z]{1}$/;
                if (!gstPattern.test(gstNumber)) {
                    e.preventDefault();
                    alert('Please enter a valid GST number (e.g., 22AAAAA0000A1Z5)');
                    document.getElementById('gst_number').focus();
                    return false;
                }
            }

            // Pincode validation
            const pincode = document.getElementById('pincode').value.trim();
            if (pincode) {
                const pincodePattern = /^[1-9][0-9]{5}$/;
                if (!pincodePattern.test(pincode)) {
                    e.preventDefault();
                    alert('Please enter a valid 6-digit pincode');
                    document.getElementById('pincode').focus();
                    return false;
                }
            }

            // IFSC validation
            const ifscCode = document.getElementById('ifsc_code').value.trim();
            if (ifscCode) {
                const ifscPattern = /^[A-Z]{4}0[A-Z0-9]{6}$/;
                if (!ifscPattern.test(ifscCode)) {
                    e.preventDefault();
                    alert('Please enter a valid IFSC code (e.g., SBIN0000123)');
                    document.getElementById('ifsc_code').focus();
                    return false;
                }
            }

            // Email validation
            const email = document.getElementById('email').value.trim();
            if (email) {
                const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (!emailPattern.test(email)) {
                    e.preventDefault();
                    alert('Please enter a valid email address');
                    document.getElementById('email').focus();
                    return false;
                }
            }

            // File size validation for document uploads
            const fileInputs = document.querySelectorAll('input[type="file"]');
            for (let input of fileInputs) {
                if (input.files.length > 0) {
                    const file = input.files[0];
                    const maxSize = 2 * 1024 * 1024; // 2MB
                    if (file.size > maxSize) {
                        e.preventDefault();
                        alert(`File "${file.name}" is too large. Maximum size allowed is 2MB.`);
                        input.focus();
                        return false;
                    }
                }
            }
        });

        // Document deletion functionality
        function deleteDocument(docType) {
            if (confirm('Are you sure you want to delete this document? This action cannot be undone.')) {
                fetch(`/shopkeeper/delete_document/${docType}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': document.querySelector('input[name="csrf_token"]').value
                    }
                })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            location.reload(); // Reload page to show updated state
                        } else {
                            alert('Error deleting document: ' + data.message);
                        }
                    })
                    .catch(error => {
                        alert('Error deleting document. Please try again.');
                        console.error('Error:', error);
                    });
            }
        }

        // File input validation on change
        document.querySelectorAll('input[type="file"]').forEach(input => {
            input.addEventListener('change', function () {
                const maxSize = 2 * 1024 * 1024; // 2MB
                if (this.files[0] && this.files[0].size > maxSize) {
                    alert('File size must be less than 2MB. Please choose a smaller file.');
                    this.value = '';
                    return false;
                }
            });
        });

        // Initialize Feather icons
        feather.replace();

        // Add hover effects to form sections
        const formSections = document.querySelectorAll('.form-section');
        formSections.forEach(section => {
            section.addEventListener('mouseenter', function () {
                this.style.transform = 'translateY(-2px)';
                this.style.boxShadow = '0 10px 20px rgba(0, 0, 0, 0.1)';
            });

            section.addEventListener('mouseleave', function () {
                this.style.transform = 'translateY(0)';
                this.style.boxShadow = '';
            });
        });
    });
</script>

{% endblock %}