{% extends 'ca/ca_base.html' %}
{% block title %}Shopkeeper Marketplace | MyBillingApp{% endblock %}
{% block firm_name %} {{ firm_name }} {% endblock %}
{% block ca_content %}
<h2 class="text-2xl font-bold text-[#ed6a3e] mb-6">Shopkeeper Marketplace</h2>
<div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8">
  {% for shop in shopkeepers %}
    <div class="bg-white rounded-2xl shadow-lg border border-gray-100 p-6 flex flex-col justify-between hover:shadow-2xl transition-shadow duration-200">
      <div>
        <!-- Selfie or Icon -->
        <div class="w-30 h-30 mx-auto mb-4 rounded-full overflow-hidden border-4 border-orange-400 flex items-center justify-center bg-gray-100">
          {% if shop.selfie_path %}
            <img src="{{ url_for('static', filename=shop.selfie_path) }}" alt="Selfie" class="object-cover w-full h-full" />
          {% else %}
            <svg class="w-12 h-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M5.121 17.804A13.937 13.937 0 0112 15c2.5 0 4.847.655 6.879 1.804M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>
          {% endif %}
        </div>
        <h3 class="text-xl font-bold text-orange-600 mb-2 text-center">{{ shop.shop_name }}</h3>
        <div class="text-gray-700 mb-1"><span class="font-semibold">Domain:</span> {{ shop.domain or '-' }}</div>
        <div class="text-gray-700 mb-1"><span class="font-semibold">Address:</span> {{ shop.address or '-' }}</div>
        <div class="mb-3">
          <span class="font-semibold">Status:</span>
          {% set conn = connections.get(shop.shopkeeper_id) %}
          {% if conn %}
            {% if conn.status == 'pending' %}
              <span class="inline-block px-3 py-1 rounded-full bg-yellow-100 text-yellow-700 text-xs font-semibold ml-2">Pending</span>
            {% elif conn.status == 'approved' %}
              <span class="inline-block px-3 py-1 rounded-full bg-green-100 text-green-700 text-xs font-semibold ml-2">Connected</span>
            {% elif conn.status == 'rejected' %}
              <span class="inline-block px-3 py-1 rounded-full bg-red-100 text-red-700 text-xs font-semibold ml-2">Rejected</span>
            {% endif %}
          {% else %}
            <span class="inline-block px-3 py-1 rounded-full bg-gray-200 text-gray-600 text-xs font-semibold ml-2">Not Connected</span>
          {% endif %}
        </div>
      </div>
      <div class="mt-4 flex justify-end">
        {% if not conn or conn.status == 'rejected' %}
          <form method="POST" action="{{ url_for('ca.connect_shopkeeper', shopkeeper_id=shop.shopkeeper_id) }}" style="display:inline;">
            <button type="submit" class="bg-gradient-to-r from-orange-500 to-orange-600 text-white px-5 py-2 rounded-xl shadow hover:from-orange-600 hover:to-orange-700 transition duration-200 text-sm font-semibold">Connect</button>
          </form>
        {% elif conn.status == 'pending' %}
          <button class="bg-yellow-400 text-white px-5 py-2 rounded-xl shadow text-sm font-semibold" disabled>Pending</button>
        {% elif conn.status == 'approved' %}
          <button class="bg-green-500 text-white px-5 py-2 rounded-xl shadow text-sm font-semibold" disabled>Connected</button>
        {% endif %}
      </div>
    </div>
  {% else %}
    <div class="col-span-full text-center text-gray-400 py-6">No shopkeepers found.</div>
  {% endfor %}
</div>
{% endblock %} 