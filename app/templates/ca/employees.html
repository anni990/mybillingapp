{% extends 'ca/ca_base.html' %}

{% block title %}Employees | MyBillingApp{% endblock %}

{% block firm_name %} {{ firm_name }} {% endblock %}

{% block ca_content %}
<div class="flex justify-between items-center mb-8">
    <h2 class="text-3xl font-bold text-gray-800">Employees Management</h2>
    <a href="/ca/employees/add" class="bg-[#ed6a3e] text-white px-5 py-2.5 rounded-lg shadow-md hover:bg-opacity-90 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[#ed6a3e] transition-all duration-300 ease-in-out flex items-center space-x-2">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd" />
        </svg>
        <span>Add Employee</span>
    </a>
</div>

<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
    {% for emp in employees %}
    <div class="bg-white rounded-2xl shadow-lg overflow-hidden transform hover:-translate-y-1 hover:shadow-2xl transition-all duration-300 ease-in-out flex flex-col">
        <div class="p-6 flex-grow">
            <div class="flex items-center space-x-4 mb-6">
                <div class="flex-shrink-0">
                    <span class="inline-flex items-center justify-center h-14 w-14 rounded-full bg-gradient-to-br from-[#f08a6b] to-[#ed6a3e] text-white text-2xl font-bold">
                        {{ emp.name[0] }}
                    </span>
                </div>
                <div class="flex-1 min-w-0">
                    <p class="text-xl font-bold text-gray-900 truncate">{{ emp.name }}</p>
                    <p class="text-sm text-gray-500 truncate">{{ emp.email }}</p>
                </div>
            </div>

            <div class="space-y-5">
                <div>
                    <h4 class="text-xs font-semibold text-gray-400 uppercase tracking-wider mb-2">Password</h4>
                    {% if emp.plain_password %}
                        <div class="flex items-center justify-between bg-gray-50 rounded-lg p-2 pl-3">
                            <p id="password-{{ emp.employee_id }}" class="text-gray-700 font-mono text-sm tracking-wider" style="user-select: none;">••••••••</p>
                            <button 
                                class="toggle-password-btn text-xs font-semibold text-blue-600 hover:text-blue-800 px-2 py-1 rounded"
                                data-target="#password-{{ emp.employee_id }}"
                                data-password="{{ emp.plain_password }}">
                                Show
                            </button>
                        </div>
                    {% else %}
                        <div class="bg-gray-50 rounded-lg p-2 pl-3">
                            <p class="text-gray-400 italic text-sm">Not Set</p>
                        </div>
                    {% endif %}
                </div>
                
                <div>
                    <h4 class="text-xs font-semibold text-gray-400 uppercase tracking-wider mb-2">Assigned Clients</h4>
                    <div class="flex flex-wrap gap-2">
                        {% for client in emp.clients %}
                            <span class="inline-block bg-blue-100 text-blue-800 rounded-full px-3 py-1 text-xs font-semibold">{{ client.shop_name }}</span>
                        {% else %}
                            <span class="text-gray-400 text-sm italic">No clients assigned</span>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
        <div class="bg-gray-50/70 px-6 py-3 flex justify-end space-x-3 border-t border-gray-100">
            <a href="/ca/employees/{{ emp.employee_id }}/edit" class="text-sm font-medium text-green-600 hover:text-green-800 transition-colors duration-200">Edit</a>
            <span class="text-gray-300">|</span>
            <a href="/ca/employees/{{ emp.employee_id }}/remove" class="text-sm font-medium text-red-600 hover:text-red-800 transition-colors duration-200">Remove</a>
        </div>
    </div>
    {% else %}
    <div class="col-span-full bg-white rounded-2xl shadow-md p-12 text-center">
        <h3 class="text-xl text-gray-600">No Employees Found</h3>
        <p class="text-gray-400 mt-2">Click 'Add Employee' to get started.</p>
    </div>
    {% endfor %}
</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const toggleButtons = document.querySelectorAll('.toggle-password-btn');

        toggleButtons.forEach(button => {
            button.addEventListener('click', () => {
                const targetSelector = button.dataset.target;
                const passwordElement = document.querySelector(targetSelector);
                const realPassword = button.dataset.password;
                
                if (passwordElement.textContent === '••••••••') {
                    // Show password
                    passwordElement.textContent = realPassword;
                    passwordElement.style.userSelect = 'text'; // Make password selectable
                    button.textContent = 'Hide';
                } else {
                    // Hide password
                    passwordElement.textContent = '••••••••';
                    passwordElement.style.userSelect = 'none'; // Prevent selecting the dots
                    button.textContent = 'Show';
                }
            });
        });
    });
</script>

{% endblock %}